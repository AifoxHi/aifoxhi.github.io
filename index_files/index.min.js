(function(){var slice=[].slice,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;window.I={libs:{react:$.Deferred(function(_this){return function(d){if(typeof React!=="undefined"&&React!==null){return d.resolve(React)}}}(this)),selectize:$.Deferred(function(_this){return function(d){var ref;if(typeof $!=="undefined"&&$!==null?(ref=$.fn)!=null?ref.selectize:void 0:void 0){return d.resolve($.fn.selectize)}}}(this)),redactor:$.Deferred(function(_this){return function(d){var ref;if(typeof $!=="undefined"&&$!==null?(ref=$.fn)!=null?ref.redactor:void 0:void 0){return d.resolve($.fn.redactor)}}}(this))},setup_page:function(){I.setup_register_referrers($(document.body));return _.defer(function(_this){return function(){return I.setup_affiliate_code()}}(this))},root_url:function(){var host;host=null;return function(path){if(!host){host=$("body").data("host")||"";if(host!==""){host=window.location.protocol+"//"+host;if(window.location.port&&window.location.port!=="80"){host+=":"+window.location.port}}}return host+"/"+path}}(),page_name:function(){return $(document.body).data("page_name")||"unknown"},get_csrf:function(){return this._csrf_token||(this._csrf_token=$("meta[name='csrf_token']").attr("value"))},with_csrf:function(thing){var token;if(thing==null){thing={}}token={csrf_token:I.get_csrf()};if($.type(thing)==="string"){return thing+"&"+$.param(token)}else{return $.extend(thing,token)}},add_params:function(_this){return function(url,p){var rest;rest=$.param(p);if(url.match(/\?/)){return url+"&"+rest}else{return url+"?"+rest}}}(this),flash:function(flash,type){if(type==null){type="notice"}this.flasher||(this.flasher=new I.Flasher);if(flash.match(/^error:/)){flash=flash.replace(/^error:/,"Error: ");type="error"}return this.flasher.show(type,flash)},slugify:function(str,opts){str=str.replace(/\s+/g,"-");str=(opts!=null?opts.for_tags:void 0)?str.replace(/[^\w_.-]/g,"").replace(/^[_.-]+/,"").replace(/[_.-]+$/,""):str.replace(/[^\w_-]/g,"");return str.toLowerCase()},truncate:function(s,len){if(s.length>len+3){return _.string.truncate(s,len)}else{return s}},ecommerce_event:function(event){if(window.ga){ga("ecommerce:addTransaction",event.transaction);ga("ecommerce:addItem",event.item);return ga("ecommerce:send")}else{return console.log("ecommerce event:",event)}},event:function(category,action,label,value,interactive){var opts;if(interactive==null){interactive=true}opts={hitType:"event",eventCategory:category,eventAction:action,eventLabel:label,eventValue:value};if(!interactive){opts.nonInteraction=1}return I.event_with_opts(opts)},event_with_opts:function(opts){try{if(typeof ga!=="undefined"&&ga!==null){return ga("send",opts)}else{console.log("event:",opts);return typeof opts.hitCallback==="function"?opts.hitCallback():void 0}}catch(error){}},event2:function(){var args;args=1<=arguments.length?slice.call(arguments,0):[]},parse_money:function(str){var cents;cents=str&&parseInt(str.replace(/[^\d]/g,""),10);return cents||0},currency_symbols:{USD:"$",GBP:"£",EUR:"€",JPY:"¥"},currency_formats:{USD:{prefix:"$"},GBP:{prefix:"£"},JPY:{prefix:"¥"},EUR:{suffix:"€"}},format_money:function(cents,currency){var dollars,symbol;if(currency==null){currency="USD"}if(cents<0){return"-"+I.format_money(-cents,currency)}symbol=I.currency_symbols[currency]||"$";if(currency==="JPY"){return symbol+cents}else{dollars=_.str.numberFormat(cents/100,2);if(currency==="EUR"){return""+dollars+symbol}else{return""+symbol+dollars}}},money_input:function(input,opts){var currency,format;if(opts==null){opts={}}input=$(input);currency=opts.currency||input.data("currency");format=I.currency_formats[currency]||{prefix:"$"};return input.maskMoney($.extend({affixesStay:true,precision:currency==="JPY"?0:2},format,opts))},plural:function(noun,count){if(count===1){return count+" "+noun}else{return count+" "+noun+"s"}},default_redactor_opts:{plugins:["source","table","alignment","video","addimage"],toolbarFixed:false,buttons:["format","bold","italic","deleted","lists","link"],minHeight:250,linkSize:80},add_recaptcha_if_necessary:function(form,errors){if(errors[0]!=="recaptcha"){return}if(!form.data("adding_recaptcha")){form.data("adding_recaptcha",true);I.with_recaptcha(function(_this){return function(){var el;el=form.find(".g-recaptcha");I.event("recaptcha","show",I.page_name());return grecaptcha.render(el[0],{sitekey:el.data("sitekey")})}}(this))}form.set_form_errors(["Please fill out the CAPTCHA to continue"]);return true},with_recaptcha:function(_this){return function(fn){var url;if(window.grecaptcha){return fn(_this)}else if(_this.recaptcha_deferred){return _this.recaptcha_deferred.done(fn)}else{_this.recaptcha_deferred=$.Deferred().done(fn);window._itch_recaptcha_loaded=function(){return this.recaptcha_deferred.resolve()};url="https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit";return $('<script type="text/javascript">').attr("src",url).appendTo("head")}}}(this),wait_for_object:function(_this){return function(obj,name,fn){var add,t,tick;t=1;add=10;tick=function(){if(obj[name]){return typeof fn==="function"?fn():void 0}t+=add;t=Math.min(500,t);return setTimeout(tick,t)};return tick()}}(this),with_redactor:function(_this){return function(fn){return I.wait_for_object($.fn,"redactor",fn)}}(this),with_selectize:function(_this){return function(fn){return I.libs.selectize.done(fn)}}(this),redactor:function(_this){return function(el,opts){var e,p;if(opts==null){opts={}}if(window.location.href.match(/\bredactor=0\b/)){return}if(!$.fn.redactor){return}opts=$.extend({},I.default_redactor_opts,opts);if(opts.source===false){delete opts.source;opts.plugins=function(){var j,len1,ref,results;ref=opts.plugins;results=[];for(j=0,len1=ref.length;j<len1;j++){p=ref[j];if(p!=="source"){results.push(p)}}return results}()}try{return el.redactor(opts)}catch(error){e=error;I.event("error","redactor","invalid_content");return el.parent().replaceWith(el).end().val("").redactor(opts)}}}(this),get_template:function(name){return _.template($("#"+name+"_tpl").html())},lazy_template:function(obj,name){return function(){var args,fn;args=1<=arguments.length?slice.call(arguments,0):[];fn=I.get_template(name);obj.prototype.template=fn;return fn.apply(null,args)}},setup_sticky_bar:function(trigger){var body,visible,win;win=$(window);body=$(document.body);trigger=$(trigger);visible=false;return win.on("scroll",function(_this){return function(e){if(win.scrollTop()>trigger.offset().top+trigger.outerHeight()){if(!visible){body.addClass("show_sticky_bar");return visible=true}}else{if(visible){body.removeClass("show_sticky_bar");return visible=false}}}}(this))},setup_selectize:function(el){return el.find(".selectize_input").each(function(i,input){var $input,REGEX_EMAIL,descriptions,optgroups,options,params,placeholder,render;$input=$(input);if($input.hasClass("selectized")){return}params={plugins:[],persist:false};if($input.is("select")){descriptions={};$input.find("option").each(function(i,option){var $option;$option=$(option);return descriptions[$option.val()]=$option.data("extra")});render=function(data,escape){var content,desc;content=escape(data.text);if(desc=descriptions[data.value]){content=content+" <span class='sub'>— "+desc+"</span>"}return"<div>"+content+"</div>"};params.render={item:render,option:render}}if(placeholder=$input.data("placeholder")){params.placeholder=placeholder}if($input.hasClass("dropdown")){params.maxItems=1}if($input.hasClass("email_selector")){REGEX_EMAIL="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+"(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)";params.valueField="email";params.labelField="name";params.searchField=["name","email"];params.render={item:function(item,escape){return"<div>"+(item.name?'<span class="name">'+escape(item.name)+"</span>":"")+(item.email?'<span class="email">'+escape(item.email)+"</span>":"")+"</div>"},option:function(item,escape){var caption,label;label=item.name||item.email;caption=item.name?item.email:null;return"<div>"+'<span class="label">'+escape(label)+"</span>"+(caption?'<span class="caption">'+escape(caption)+"</span>":"")+"</div>"}};params.createFilter=function(input){var match,regex;regex=new RegExp("^"+REGEX_EMAIL+"$","i");match=input.match(regex);if(match){return!this.options.hasOwnProperty(match[0])}regex=new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i");match=input.match(regex);if(match){return!this.options.hasOwnProperty(match[2])}return false};params.create=function(input){var match;if(new RegExp("^"+REGEX_EMAIL+"$","i").test(input)){return{email:input}}match=input.match(new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i"));if(match){return{email:match[2],name:$.trim(match[1])}}alert("Invalid email address.");return false}}if(options=$input.data("options")){if($input.hasClass("email_selector")){params.options=options}else if($input.hasClass("options_object")){params.options=options;params.searchField=["text","keywords"]}else{params.options=options.map(function(opt){return{value:opt[0],text:opt[1]}})}params.plugins.push("remove_button");params.delimiter=",";params.persist=false}if(optgroups=$input.data("optgroups")){params.optgroups=optgroups}return $input.selectize(params)})},format_dates:function(outer,method){var el,j,len1,ref,results;if(method==null){method="calendar"}moment.lang("en",{calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"[last] dddd [at] LT",nextWeek:"dddd [at] LT",sameElse:"MMMM Do YYYY [at] LT"}});ref=outer.find(".date_format");results=[];for(j=0,len1=ref.length;j<len1;j++){el=ref[j];results.push(function(el){var full_date,method_args,real_method,ref1;real_method=el.data("format_method")||method;method_args=el.data("format_args")||[];if(!_.isArray(method_args)){method_args=[method_args]}full_date=el.html();return el.html((ref1=moment.utc(full_date).local())[real_method].apply(ref1,method_args)).attr("title",full_date+" UTC")}($(el)))}return results},specific_humanize:function(duration,num_parts){var fn,j,key,len1,out,pair,pairs,single,val;if(num_parts==null){num_parts=null}pairs=[["y","years","a year"],["m","months","a month"],["d","days","a day"],["h","hours","an hour"],["m","minutes","a minute"],["s","seconds","a second"]];out=[];for(j=0,len1=pairs.length;j<len1;j++){pair=pairs[j];if(num_parts&&out.length===num_parts){break}key=pair[0],fn=pair[1],single=pair[2];val=duration[fn]();if(val>0){if(val>1){if(fn==="seconds"){out.push("a few seconds")}else{out.push(val+" "+fn)}}else{out.push(single)}}}if(out.length>1){out[out.length-1]="and "+out[out.length-1]}return out.join(", ")},format_filesize:function(outer,selector){var file_size,j,len1,ref,results;if(selector==null){selector=".file_size_value"}ref=outer.find(selector);results=[];for(j=0,len1=ref.length;j<len1;j++){file_size=ref[j];file_size=$(file_size);results.push(file_size.html(_.str.formatBytes(parseInt(file_size.html()))))}return results},adjust_font_size_to_fit:function(_this){return function(el,min_size){var _el,font_size,results;if(min_size==null){min_size=16}if(!el.length){return}font_size=el.css("font-size");font_size=parseInt(font_size.match(/\d+/),10);_el=el[0];results=[];while(_el.offsetWidth<_el.scrollWidth){font_size-=2;if(font_size<min_size){break}results.push(el.css("font-size",font_size+"px"))}return results}}(this),date_format:"yy-mm-dd",time_format:"HH:mm:ss",to_local_time:function(t){return moment.utc(t,"YYYY-MM-DD HH:mm:ss").local().toDate()},format_date_time:function(d){var date,time;time=$.datepicker.formatTime(this.time_format,{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()});date=$.datepicker.formatDate(this.date_format,new Date(d));return date+" "+time},format_date:function(d){return $.datepicker.formatDate(this.date_format,new Date(d))},datetimepicker:function(pickers,opts){var j,len1,p,picker,val;for(j=0,len1=pickers.length;j<len1;j++){p=pickers[j];picker=$(p);if(val=picker.attr("value")){picker.val(this.format_date_time(this.to_local_time(val)))}}return pickers.datetimepicker($.extend({timeFormat:this.time_format,dateFormat:this.date_format,beforeShow:function(_this){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)});return void 0}}(this)},opts))},datepicker:function(pickers,opts){return pickers.datepicker($.extend({dateFormat:this.date_format,beforeShow:function(_this){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)});return void 0}}(this)},opts))},slug_input:function(_this){return function(input,bound_input){var valid_slug_chars;valid_slug_chars=/[a-z_0-9_-]/g;input.on("keypress",function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}});if(bound_input&&bound_input.length){input.on("change",function(e){var slug;slug=I.slugify(bound_input.val());if(input.val().match(/^\s*$/)&&slug!==""){return input.val(slug)}});return bound_input.on("change",function(e){if(input.val().match(/^\s*$/)){return input.val(I.slugify($(e.currentTarget).val()))}})}}}(this),deferred_links:function(el,selector,promise_fn){promise_fn||(promise_fn=I.delegate_tracking);el.on("mouseup",selector,function(e){var target;if(e.which!==2){return}target=$(e.currentTarget);return promise_fn(target,e)});return el.on("click",selector,function(e){var finished,is_blank,ref,target;if(e.which!==1){return}target=$(e.currentTarget);is_blank=e.metaKey||e.ctrlKey||e.shiftKey||target.attr("target")==="_blank";finished=null;if(!is_blank){finished=function(_this){return function(){if(!finished){return}finished=null;return window.location=target.attr("href")}}(this);setTimeout(function(_this){return function(){return typeof finished==="function"?finished():void 0}}(this),200)}if((ref=promise_fn(target,e))!=null){ref.done(finished)}if(!is_blank){return false}})},delegate_tracking:function(_this){return function(el){var promises;promises=[];el.trigger("i:delegate_tracking",[function(p){return promises.push(p)}]);return $.when.apply($,promises)}}(this),ga_tracker:function(_this){return function(category,action,label,value){var send_event;return send_event=function(target){var opts,ref,ref1,ref2,ref3;opts={hitType:"event",eventCategory:(ref=target.data("category"))!=null?ref:category,eventAction:(ref1=target.data("action"))!=null?ref1:action,eventLabel:(ref2=target.data("label"))!=null?ref2:label,eventValue:(ref3=target.data("value"))!=null?ref3:value};return $.Deferred(function(_this){return function(d){opts.hitCallback=function(){return d.resolve()};return I.event_with_opts(opts)}}(this))}}}(this),tracked_links:function(){var action,category,el,label,rest,tracker,value;el=arguments[0],rest=2<=arguments.length?slice.call(arguments,1):[];category=rest[0],action=rest[1],label=rest[2],value=rest[3];tracker=I.ga_tracker(category,action,label,value);I.deferred_links(el,"a[data-label]",tracker);return el.on("i:track_link",function(e,l){var _label;if(l){_label=l[0]}return I.ga_tracker(category,action,_label!=null?_label:label,value)($(e.target))})},set_cookie:function(name,value,opts){if(opts==null){opts={}}if(I.in_dev){console.log("set cookie:",[name,value],opts)}return Cookies.set(name,value,$.extend({path:"/",domain:"."+$(document.body).data("host")},opts))},set_register_referrer:function(_this){return function(action){var page;page=I.page_name();if(page!=null){I.set_cookie("ref:register:page_params",page)}if(action!=null){return I.set_cookie("ref:register:action",action)}}}(this),setup_register_referrers:function(_this){return function(el){if(I.current_user){return}return el.on("mouseup","[data-register_action]",function(e){var action;action=$(e.currentTarget).data("register_action");return I.set_register_referrer(action)})}}(this),setup_affiliate_code:function(_this){return function(code,replace){var location,ref;if(replace==null){replace=false}if(code==null){code=(ref=window.location.search.match(/\bac=([\w\d]+)/))!=null?ref[1]:void 0}if(!code){return}if(!replace&&code===Cookies.get("acode")){return}I.set_cookie("acode",code,{expires:1});if(document.referrer){I.set_cookie("acode:ref",document.referrer.substring(0,180),{expires:1})}location=window.location.href.replace(/\?.*$/,"").substring(0,180);return I.set_cookie("acode:land",location,{expires:1})}}(this),setup_grid_referrers:function(_this){return function(el,value_fn){var set_cookie_for;set_cookie_for=function(el){var game_id,sale,sale_id,sale_type;if(!el.closest(".game_author").length){if(game_id=el.closest("[data-game_id]").data("game_id")){I.ReferrerTracker.push("game",game_id,value_fn(el))}}if(!el.closest(".sale_author").length){sale=el.closest("[data-sale_id]");if(sale_id=sale.data("sale_id")){sale_type=sale.data("sale_type");return I.ReferrerTracker.push(sale_type,sale_id,value_fn(el))}}};el.on("mouseup",".game_cell a, .sale_row a, .leader_game a",function(e){if(e.which>3){return}return set_cookie_for($(e.currentTarget))});return el.on("i:track_link",function(e){return set_cookie_for($(e.target))})}}(this),bind_checkbox_to_input:function(_this){return function(checkbox,input,callback){var update_state;update_state=function(){var checked;checked=checkbox.prop("checked");input.prop("disabled",checked);return typeof callback==="function"?callback(checked):void 0};checkbox.on("change",update_state);return update_state()}}(this),add_facebook:function(_this){return function(callback){var fjs,id,js;if(window.FB){return}_this.add_facebook=function(){};$('<div id="fb-root"></div>').appendTo(document.body);id="facebook-jssdk";if(document.getElementById(id)){return}if(callback!=null){window.fbAsyncInit=callback}fjs=document.getElementsByTagName("script")[0];js=document.createElement("script");js.id=id;js.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0";return fjs.parentNode.insertBefore(js,fjs)}}(this),add_twitter:function(_this){return function(){var fjs,id,js;id="twitter-wjs";if(document.getElementById(id)){return}_this.add_twitter=function(){};fjs=document.getElementsByTagName("script")[0];js=document.createElement("script");js.id="twitter-wjs";js.src="//platform.twitter.com/widgets.js";return fjs.parentNode.insertBefore(js,fjs)}}(this),has_follow_button:function(_this){return function(el,opts){var animate_follow,animate_unfollow,cls,params,ref,ref1,ref2;if(opts==null){opts={}}el=$(el);cls=(ref=opts.cls)!=null?ref:"follow_button_widget";animate_follow=(ref1=opts.animate_follow)!=null?ref1:"animate_bounce";animate_unfollow=(ref2=opts.animate_unfollow)!=null?ref2:"animate_drop_down";params={};params[cls]=function(btn){var data,following,timeout,url;if(!I.current_user){return"continue"}if(btn.is(".loading")){return}btn.removeClass(animate_follow+" "+animate_unfollow);timeout=$.Deferred(function(d){return setTimeout(function(){return d.resolve()},500)});following=btn.is(".is_following");url=following?(_.defer(function(){return btn.addClass(animate_unfollow)}),btn.data("unfollow_url")):(_.defer(function(){return btn.addClass(animate_follow)}),btn.data("follow_url"));btn.addClass("loading").trigger("i:track_link",["follow_btn"]);data=btn.data("follow_data")||{};return $.when($.post(url,I.with_csrf(data)),timeout).done(function(arg){var res;res=arg[0];btn.removeClass("loading "+animate_follow+" "+animate_unfollow);if(res.errors){I.flash(res.errors.join(", "));return}return btn.toggleClass("is_following",res.following).trigger("i:follow_updated",[{user_id:btn.data("user_id"),following:res.following,btn:btn}])})};el.dispatch("click",params);return $(document.body).on("i:follow_updated",function(e,arg){var btn,following,user_id;user_id=arg.user_id,following=arg.following,btn=arg.btn;return el.find("."+cls+"[data-user_id="+user_id+"]").not(btn).toggleClass("is_following",following)})}}(this),is_mobile:function(_this){return function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}(this),strip_css:function(_this){return function(str){return str.replace(/<\s*\/\s*style\s*>/i,"")}}(this),request_fullscreen:function(_this){return function(el,orientation){var entered,ref,ref1;entered=el.requestFullscreen?(el.requestFullscreen(),true):el.msRequestFullscreen?(el.msRequestFullscreen(),true):el.mozRequestFullScreen?(el.mozRequestFullScreen(),true):el.webkitRequestFullscreen?(el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),true):false;if(entered&&orientation){if((ref=window.screen)!=null){if((ref1=ref.orientation)!=null){if(typeof ref1.lock==="function"){ref1.lock(orientation)}}}}return entered}}(this),is_fullscreen:function(_this){return function(){return!(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)}}(this),exit_fullscreen:function(_this){return function(){if(document.exitFullscreen){return document.exitFullscreen()}else if(document.msExitFullscreen){return document.msExitFullscreen()}else if(document.mozCancelFullScreen){return document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){return document.webkitExitFullscreen()}}}(this),toggle_fullscreen:function(_this){return function(el,orientation){if(I.is_fullscreen()){I.exit_fullscreen();return false}else{if(!I.request_fullscreen(el,orientation)){return"failed"}return true}}}(this),setup_dirty_warning:function(_this){return function(form,cb){cb||(cb=function(){return form.data("dirty")});form.data("dirty",false);$(window).on("beforeunload",function(){var msg;msg=cb();if(!msg){return}switch(typeof msg){case"string":return msg;default:return"You've made modifications to this page."}});form.on("i:after_submit",function(){return form.data("dirty",false)});return _.defer(function(){form.on("change","input, select, textarea",function(e){return form.data("dirty",true)});return form.on("keydown, mousedown",".redactor-editor",function(){return form.data("dirty",true)})})}}(this),remote_submit:function(_this){return function(form,more_data){var buttons,data;form.trigger("i:before_submit");data=form.serializeArray();buttons=form.addClass("loading").find("button, input[type='submit'], input[type='checkbox']").prop("disabled",true).addClass("disabled");return $.when(more_data).then(function(d){var ref;if(d){data=data.concat(d)}return $.ajax({data:data,type:(ref=form.attr("method"))!=null?ref:"POST",url:form.attr("action"),xhrFields:{withCredentials:true},error:function(xhr){return I.flash("We seem to be having server problems right now! Please try again later.")},complete:function(){buttons.prop("disabled",false).removeClass("disabled");form.removeClass("loading");return form.trigger("i:after_submit")}})})}}(this),is_middle_click:function(_this){return function(e){return 2===e.which||e.metaKey||e.ctrlKey}}(this),escape_regex:function(_this){return function(str){return str.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}(this),move:function(array,item,dir){var copy,idx,o,target_idx;idx=array.indexOf(item);if(idx===-1){throw"Failed to find object in array"}target_idx=idx+dir;if(target_idx<0||target_idx>=array.length){throw"Movement is outside of array ("+target_idx+") [0, "+(array.length-1)+"]"}copy=function(){var j,len1,results;results=[];for(j=0,len1=array.length;j<len1;j++){o=array[j];if(o!==item){results.push(o)}}return results}();copy.splice(target_idx,0,item);return copy},format_integer:function(num){if(num>1e7){return Math.floor(num/1e6)+"m"}else if(num>=1e6){return Math.floor(num/1e5)/10+"m"}else if(num>1e4){return Math.floor(num/1e3)+"k"}else if(num>=1e3){return Math.floor(num/100)/10+"k"}else{return""+num}}};$(function(){var match;if(match=window.location.hash.match(/\bflash=([^&]*)/)){I.flash(match[1]);window.location.hash=window.location.hash.replace(/\bflash=([^&]*)/,"")}if(I.ie){return $(document.body).addClass("ie")}});I.Flasher=function(){Flasher.prototype.duration=1e4;Flasher.prototype.animation_duration=250;Flasher.prototype.clipping="-7px";function Flasher(){$(document).on("click",".global_flash",function(_this){return function(){return _this.dismiss()}}(this))}Flasher.prototype.dismiss=function(){var elm;if(elm=this.current_flash){if(this.timeout){clearTimeout(this.timeout);this.timeout=null}elm.css({"margin-top":"-"+(elm.outerHeight()+4)+"px"});return setTimeout(function(_this){return function(){return elm.remove()}}(this),this.animation_duration*2)}};Flasher.prototype.show=function(type,msg){var elm;this.dismiss();elm=$("<div class='global_flash "+type+"'>").text(msg).appendTo("body");elm.css({"margin-left":"-"+elm.width()/2+"px","margin-top":"-"+(elm.outerHeight()+4)+"px"});this.timeout=setTimeout(function(_this){return function(){elm.addClass("animated");elm.css({"margin-top":_this.clipping});return setTimeout(function(){return _this.dismiss()},_this.duration)}}(this),100);return this.current_flash=elm};return Flasher}();I.InfiniteScroll=function(){InfiniteScroll.prototype.loading_element=".grid_loader";function InfiniteScroll(el){this.el=$(el);this.setup_loading()}InfiniteScroll.prototype.get_next_page=function(){return alert("override me")};InfiniteScroll.prototype.setup_loading=function(){var check_scroll_pos,win;this.loading_row=this.el.find(this.loading_element);if(!this.loading_row.length){return}win=$(window);check_scroll_pos=function(_this){return function(){if(_this.el.is(".loading")){return}if(win.scrollTop()+win.height()>=_this.loading_row.offset().top){return _this.get_next_page()}}}(this);win.on("scroll.browse_loader",check_scroll_pos);return check_scroll_pos()};InfiniteScroll.prototype.remove_loader=function(){$(window).off("scroll.browse_loader");return this.loading_row.remove()};return InfiniteScroll}();I.InfiniteGameGrid=function(superClass){extend(InfiniteGameGrid,superClass);function InfiniteGameGrid(){return InfiniteGameGrid.__super__.constructor.apply(this,arguments)}InfiniteGameGrid.prototype.method="post";InfiniteGameGrid.prototype.current_page=1;InfiniteGameGrid.prototype.get_next_page=function(){this.current_page+=1;this.el.addClass("loading");return $[this.method]("",{page:this.current_page,format:"json"},function(_this){return function(res){_this.el.removeClass("loading");if(res.num_items>0){return _this.grid.add_image_loading($(res.content).appendTo(_this.grid.el).hide().fadeIn())}else{return _this.remove_loader()}}}(this))};return InfiniteGameGrid}(I.InfiniteScroll);_.templateSettings={escape:/\{\{(?![&])(.+?)\}\}/g,interpolate:/\{\{&(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g};_.str.formatBytes=function(){var thresholds;thresholds=[["gb",Math.pow(1024,3)],["mb",Math.pow(1024,2)],["kb",1024]];return function(bytes){var j,label,len1,min,ref;for(j=0,len1=thresholds.length;j<len1;j++){ref=thresholds[j],label=ref[0],min=ref[1];if(bytes>=min){return""+_.str.numberFormat(bytes/min)+label}}return _.str.numberFormat(bytes)+" bytes"}}();$.easing.smoothstep=function(t){return t*t*t*(t*(t*6-15)+10)}}).call(this);(function(){var DEFAULT_LOCALE,Preloader,current_locale,defer,interpolate,interpolate_react,prefix_req_cache,ref,translations,slice=[].slice,hasProp={}.hasOwnProperty;translations={};prefix_req_cache={};DEFAULT_LOCALE="en";current_locale=(ref=window.itchio_locale)!=null?ref:DEFAULT_LOCALE;defer=window.requestAnimationFrame||_.defer;interpolate=function(buffer,parts,variables){var contents,fn,i,len,part,tag_buffer,val;for(i=0,len=parts.length;i<len;i++){part=parts[i];if(_.isString(part)){buffer.push(part)}else if(part[0]==="v"){val=variables[part[1]];if(!val){console.warn("i18n: failed to find value for variable "+part[1])}buffer.push(val)}else if(part[0]==="t"){fn=variables[part[1]];if(typeof fn!=="function"){throw new Error("i18n: tried to interpolate tag without function: "+part[1])}contents=part[2];tag_buffer=[];interpolate(tag_buffer,contents||[],variables);buffer.push(fn(tag_buffer.join("")))}else{throw new Error("i18n: unknown interpolation node: "+JSON.stringify(part))}}return buffer};interpolate_react=function(parts,variables){var fn,out,part,val;if(_.isString(parts)){return parts}out=function(){var i,len,results;results=[];for(i=0,len=parts.length;i<len;i++){part=parts[i];if(_.isString(part)){results.push(part)}else if(part[0]==="v"){val=variables[part[1]];if(!val){console.warn("i18n: failed to find value for variable "+part[1])}results.push(val)}else if(part[0]==="t"){fn=variables[part[1]];if(typeof fn!=="function"){throw new Error("i18n: tried to interpolate tag without function: "+part[1])}results.push(fn(interpolate_react(part[2],variables)))}else{throw new Error("i18n: unknown interpolation node: "+JSON.stringify(part))}}return results}();if(out.length>1){return React.createElement.apply(React,[React.Fragment,{}].concat(slice.call(out)))}else if(out.length===0){return null}else{return out}};Preloader=function(){Preloader._cache={};Preloader.for_locale=function(l){var base;return(base=this._cache)[l]||(base[l]=new Preloader(l))};function Preloader(locale1){this.locale=locale1;this.last_fetch=null;this.next_fetch=null}Preloader.prototype.fetch=function(prefixes,translations){if(this.next_fetch){this.next_fetch=this.next_fetch.concat(prefixes);return this.last_fetch}else{this.next_fetch=prefixes;return this.last_fetch=$.Deferred(function(_this){return function(d){return defer(function(){var n,r;if(!I.translations_url){console.error("missing translations url: I.translations_url");return}n=_this.next_fetch;r=$.get(I.translations_url,{locale:_this.locale,prefixes:_this.next_fetch.join(",")});_this.next_fetch=null;return r.done(function(res){var k,v;for(k in res){if(!hasProp.call(res,k))continue;v=res[k];if(translations[k]){continue}translations[k]=v}return d.resolve()})})}}(this))}};return Preloader}();I.i18n={Preloader:Preloader,get_translations:function(){return translations},get_cache:function(){return prefix_req_cache},get_locale:function(){return current_locale},insert:function(obj){var k,results,v;results=[];for(k in obj){if(!hasProp.call(obj,k))continue;v=obj[k];if(translations[k]){continue}results.push(translations[k]=v)}return results},set_locale:function(v){current_locale=v;translations={};return prefix_req_cache={}},render_string:function(key,obj,variables){var buffer;if(_.isString(obj)){if(variables){console.warn("i18n: provided variables to translation string with no interpolation: "+key)}return obj}else{buffer=[];if(!variables){throw new Error("i18n: tried to interpolate "+key+" without variables")}interpolate(buffer,obj,variables);return buffer.join("")}},t:function(key,variables){return I.i18n.fetch_key(key).then(function(_this){return function(obj){return I.i18n.render_string(key,obj,variables)}}(this))},t_sync:function(_this){return function(key,variables){var obj;obj=I.i18n.fetch_key_sync(key);if(!obj){throw new Error("i18n: failed to fetch key sync: "+key)}return I.i18n.render_string(key,obj,variables)}}(this),fetch_key_sync:function(key){if(current_locale==="debug"){return"[["+key+"]]"}else{return translations[key]}},fetch_key:function(key){var parts,prefix;if(current_locale==="debug"){return $.when("[["+key+"]]")}parts=key.split(".");parts.pop();if(!parts.length){throw new Error("i18n: empty prefix")}prefix=parts.join(".");return I.i18n.preload(prefix).then(function(_this){return function(){var text;text=translations[key];if(text){return text}if(current_locale===DEFAULT_LOCALE){throw new Error("i18n: failed to find key: "+key)}return I.i18n.preload(prefix,DEFAULT_LOCALE).then(function(){text=translations[key];if(!text){throw new Error("i18n: failed to find key: "+key)}return text})}}(this))},preload:function(prefixes,locale){var cache,currently_loading,d,i,len,p,to_fetch;if(locale==null){locale=current_locale}if(locale==="debug"){return}cache=prefix_req_cache;if(_.isString(prefixes)){prefixes=[prefixes]}to_fetch=function(){var i,len,results;results=[];for(i=0,len=prefixes.length;i<len;i++){p=prefixes[i];cache[locale]||(cache[locale]={});if(cache[locale][p]){continue}results.push(p)}return results}();currently_loading=function(){var i,len,ref1,results;results=[];for(i=0,len=prefixes.length;i<len;i++){p=prefixes[i];if(((ref1=cache[locale][p])!=null?ref1.state():void 0)==="pending"){results.push(cache[locale][p])}}return results}();if(!to_fetch.length){return $.when.apply($,currently_loading)}d=Preloader.for_locale(locale).fetch(to_fetch,translations);for(i=0,len=to_fetch.length;i<len;i++){p=to_fetch[i];if(!cache[locale][p]){cache[locale][p]=d}}if(currently_loading.length){return $.when.apply($,[d].concat(slice.call(currently_loading)))}else{return d}},react_class:function(key){return createReactClass({displayName:"i18n:"+key,getInitialState:function(){var fn;fn=function(){var text;if(text=I.i18n.fetch_key_sync(key)){return{text:text}}else{return null}};fn.isReactClassApproved=true;return fn}(),componentWillUnmount:function(){return this.unmounted=true},componentDidMount:function(){if(!(this.state&&this.state.text)){return I.i18n.fetch_key(key).done(function(_this){return function(res){if(_this.unmounted){return}return _this.setState({text:res})}}(this))}},render:function(){if(this.state){if(_.isString(this.state.text)){return this.state.text}else{return interpolate_react(this.state.text,this.props)}}else{return"…"}}})}}}).call(this);(function(){var EMPTY,is_different,translation_component_cache,hasProp={}.hasOwnProperty,slice=[].slice;if(window.R){return}EMPTY={};is_different=function(a,b){var key;for(key in a){if(!hasProp.call(a,key))continue;if(a[key]!==b[key]){return true}}for(key in b){if(!hasProp.call(b,key))continue;if(!(key in a)){return true}}return false};translation_component_cache={};window.R=function(name,data,p,prefix){var cl,class_name,default_props,prop_types;if(p==null){p=R}if(prefix==null){prefix=""}data.trigger=function(){var node;node=$(ReactDOM.findDOMNode(this));R.trigger.apply(R,[node].concat(slice.call(arguments)));return void 0};data.dispatch=function(){var node;node=$(ReactDOM.findDOMNode(this));R.dispatch.apply(R,[node].concat(slice.call(arguments)));return void 0};data.container=function(){return $(ReactDOM.findDOMNode(this))};data.extend_props=function(){var more;more=1<=arguments.length?slice.call(arguments,0):[];return $.extend.apply($,[{},this.props].concat(slice.call(more)))};data.tt=function(key,props){var text;if(props==null){props=EMPTY}if(text=I.i18n.fetch_key_sync(key)){if(_.isString(text)){return text}}translation_component_cache[key]||(translation_component_cache[key]=I.i18n.react_class(key));return React.createElement(translation_component_cache[key],props)};data.t=function(key,variables){if(I.i18n.fetch_key_sync(key)){return I.i18n.t_sync(key,variables)}else{I.i18n.fetch_key(key).done(function(_this){return function(){if(_this.isMounted()){return _this.forceUpdate()}}}(this));return"…"}};class_name=_.once(function(){return(""+prefix+name).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"});data.enclosing_class_name=class_name;data.enclose=function(){var args,component,props;props=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];component=props.component||"div";delete props.component;return React.createElement.apply(React,[component,$.extend({},props,{className:classNames(class_name(),props.className)})].concat(slice.call(args)))};data.displayName=""+prefix+name;if(data.pure){data.shouldComponentUpdate=function(nextProps,nextState){return is_different(this.props||EMPTY,nextProps)||is_different(this.state||EMPTY,nextState)}}default_props=data.getDefaultProps;delete data.getDefaultProps;prop_types=data.propTypes;delete data.propTypes;cl=createReactClass(data);if(default_props){cl.defaultProps=default_props()}if(prop_types){cl.propTypes=prop_types}p[name]=React.createFactory(cl);return p[name]._class=cl};R.scope_event_name=function(name){return"itch:"+name};R.trigger=function(){var args,name,node;node=arguments[0],name=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];return node.trigger(R.scope_event_name(name),slice.call(args))};R.dispatch=function(node,prefix,event_table){var event_name,fn,results;if(typeof prefix==="object"){event_table=prefix;prefix=false}results=[];for(event_name in event_table){if(!hasProp.call(event_table,event_name))continue;fn=event_table[event_name];if(prefix){event_name=prefix+":"+event_name}results.push(node.on(R.scope_event_name(event_name),fn))}return results};R.component=function(){return R.apply(null,arguments)};R.is_different=is_different;R["package"]=function(_this){return function(prefix){var p;p=R[prefix]||(R[prefix]=function(name,data){data.Package=p;return R.component(name,data,p,prefix+".")});p.component=function(){return p.apply(null,arguments)};return p}}(this)}).call(this);(function(){$.fn.dispatch=function(event_type,table){this.on(event_type,function(_this){return function(e){var elm,fn,key,res;for(key in table){fn=table[key];elm=$(e.target).closest("."+key);if(!elm.length){continue}if(elm.is(".disabled")){return false}res=fn(elm,e);if(res==="continue"){return}return false}return null}}(this));return this}}).call(this);(function(){var show_images;I.support_passive_scroll=function(){var opts,supports;supports=false;try{opts=Object.defineProperty({},"passive",{get:function(_this){return function(){return supports=true}}(this)});window.addEventListener("test",null,opts)}catch(error){}return supports};I.support_intersection_observer=function(){return"IntersectionObserver"in window};show_images=function(item,make_promise){var cell,cells,fn,images,img,j,len,ref;item.removeClass("lazy_images");cells=item.find("[data-background_image]").addBack("[data-background_image]");images=function(){var j,len,results;results=[];for(j=0,len=cells.length;j<len;j++){cell=cells[j];results.push(function(cell){var image_url;cell=$(cell);image_url=cell.data("background_image");cell.css({backgroundImage:"url("+image_url+")"});if(make_promise){return $.Deferred(function(_this){return function(d){return $("<img />").attr("src",image_url).on("load",function(){return d.resolve()})}}(this))}}(cell))}return results}();ref=item.find("img[data-lazy_src]").addBack("img[data-lazy_src]");fn=function(img){var image_url,srcset;img=$(img);image_url=img.data("lazy_src");img.attr("src",image_url);if(srcset=img.data("lazy_srcset")){img.attr("srcset",srcset)}if(make_promise){return $.Deferred(function(_this){return function(d){return img.on("load",function(){return d.resolve()})}}(this))}};for(j=0,len=ref.length;j<len;j++){img=ref[j];fn(img)}if(make_promise){if(images.length===1){return images[0]}else{return $.when.apply($,images)}}};$.fn.lazy_images=function(opts){var _show_images,check_images,el,handle_intersect,horizontal,io,j,lazy,len,ref,refresh,selector,target,throttled,unbind,win;if(refresh=this.data("lazy_images")){return refresh()}lazy=(opts!=null?opts.elements:void 0)?function(){var j,len,ref,results;ref=opts.elements;results=[];for(j=0,len=ref.length;j<len;j++){el=ref[j];results.push($(el))}return results}():(selector=(opts!=null?opts.selector:void 0)||".lazy_images",function(){var j,len,ref,results;ref=this.find(selector);results=[];for(j=0,len=ref.length;j<len;j++){el=ref[j];results.push($(el))}return results}.call(this));_show_images=(ref=opts!=null?opts.show_images:void 0)!=null?ref:show_images;if(I.support_intersection_observer()){handle_intersect=function(entities){var d,entity,j,len,on_show,results;results=[];for(j=0,len=entities.length;j<len;j++){entity=entities[j];if(entity.isIntersecting){el=entity.target;io.unobserve(el);el=$(el);on_show=opts!=null?opts.show_item:void 0;d=_show_images(el,!!on_show);results.push(typeof on_show==="function"?on_show(el,d):void 0)}else{results.push(void 0)}}return results};io=new IntersectionObserver(handle_intersect,{});for(j=0,len=lazy.length;j<len;j++){el=lazy[j];io.observe(el[0])}return function(){return io.disconnect()}}win=$(window);target=opts!=null?opts.target:void 0;horizontal=opts!=null?opts.horizontal:void 0;unbind=null;check_images=function(_this){return function(){var cuttoff,d,found,i,item,k,len1,on_show,position;cuttoff=function(){if(target){if(horizontal){return target.outerWidth()+target.position().left}else{throw new Error("not yet")}}else{return win.scrollTop()+win.height()}}();found=0;for(i=k=0,len1=lazy.length;k<len1;i=++k){item=lazy[i];if(!item){continue}if(!document.body.contains(item[0])){lazy[i]=null;found+=1;continue}position=function(){if(target){if(horizontal){return item.position().left}else{throw new Error("not yet")}}else{return item.offset().top}}();if(!item[0].offsetParent){continue}if(position<cuttoff){on_show=opts!=null?opts.show_item:void 0;d=_show_images(item,!!on_show);if(typeof on_show==="function"){on_show(item,d)}found+=1;lazy[i]=null}}if(found>0){return lazy=function(){var l,len2,results;results=[];for(l=0,len2=lazy.length;l<len2;l++){el=lazy[l];if(el){results.push(el)}}return results}()}}}(this);throttled=_.throttle(check_images,100);if(target){target.on("scroll",throttled);win.on("resize",throttled);unbind=function(){target.off("scroll",throttled);return win.off("resize","throttled")}}else{if(I.support_passive_scroll()){window.addEventListener("scroll",throttled,{passive:true});win.on("resize i:reshape",throttled);unbind=function(){window.removeEventListener("scroll",throttled,{passive:true});return win.off("resize",throttled)}}else{win.on("scroll resize i:reshape",throttled);unbind=function(){return win.off("scroll resize i:reshape",throttled)}}}this.data("lazy_images",function(_this){return function(){lazy=(opts!=null?opts.elements:void 0)?function(){var k,len1,ref1,results;ref1=opts.elements;results=[];for(k=0,len1=ref1.length;k<len1;k++){el=ref1[k];results.push($(el))}return results}():(selector=(opts!=null?opts.selector:void 0)||".lazy_images",function(){var k,len1,ref1,results;ref1=this.find(selector);results=[];for(k=0,len1=ref1.length;k<len1;k++){el=ref1[k];results.push($(el))}return results}.call(_this));return check_images()}}(this));check_images();return unbind}}).call(this);(function(){$.fn.exists=function(){if(this.length>0){return this}else{return false}}}).call(this);(function(){$.fn.remote_submit=function(fn,validate_fn,more_data){var click_input;click_input=null;this.on("click","button[name], input[type='submit'][name]",function(_this){return function(e){var btn;btn=$(e.currentTarget);if(click_input!=null){click_input.remove()}return click_input=$("<input type='hidden' />").attr("name",btn.attr("name")).val(btn.attr("value")).prependTo(_this)}}(this));return this.on("submit",function(_this){return function(e,callback){var form;e.preventDefault();form=$(e.currentTarget);if(validate_fn){if(!(typeof validate_fn==="function"?validate_fn(form):void 0)){return}}I.remote_submit(form,more_data).done(function(res){form.data("dirty",false);if(callback!=null){return callback(res,form)}else{return fn(res,form)}});return null}}(this))}}).call(this);(function(){$.fn.set_form_errors=function(errors,scroll_to,msg){var base,e,errors_el,errors_list,has_errors,i,len,lightbox;if(scroll_to==null){scroll_to=true}if(msg==null){msg="Errors"}this.find(".form_errors").remove();has_errors=!!(errors!=null?errors.length:void 0);this.toggleClass("has_errors",has_errors);if(has_errors){errors_el=$(_.template('<div class="form_errors">\n  <div>{{ msg }}:</div>\n  <ul></ul>\n</div>')({msg:msg}));errors_list=errors_el.find("ul");for(i=0,len=errors.length;i<len;i++){e=errors[i];errors_list.append($("<li></li>").text(e))}this.prepend(errors_el);if(scroll_to){lightbox=this.closest(".lightbox");if(lightbox.length||this.offset().top>$(window).height()/2){if(typeof(base=this[0]).scrollIntoView==="function"){base.scrollIntoView()}}else{$("html, body").animate({scrollTop:0},"fast")}}}return this}}).call(this);(function(){$.fn.has_tooltips=function(opts){var hide,refresh,show,show_tooltip,tooltip_drop,tooltip_template;if(opts==null){opts={}}if(I.is_mobile()){return}tooltip_drop=function(){var drop;drop=$('<div class="tooltip_drop"></div>');$(document.body).append(drop);tooltip_drop=function(){return drop};return drop};tooltip_template=_.template('<div class="tooltip">{{ label }}</div>');show_tooltip=function(tooltip_target,instant){var el,height,offset,width;if(instant==null){instant=false}el=tooltip_target.data("tooltip_el");if(!el){el=$(tooltip_template({label:tooltip_target.attr("aria-label")||tooltip_target.data("tooltip")}));tooltip_target.data("tooltip_el",el)}el.removeClass("visible");tooltip_drop().empty().append(el);offset=tooltip_target.offset();height=el.outerHeight();width=el.outerWidth();el.css({position:"absolute",top:opts.below?offset.top+tooltip_target.outerHeight()+10:offset.top-height-10,left:Math.floor(offset.left+(tooltip_target.outerWidth()-width)/2)});el.toggleClass("below",!!opts.below);if(instant){return el.addClass("visible")}else{return setTimeout(function(_this){return function(){return el.addClass("visible")}}(this),10)}};refresh=function(_this){return function(e){var el,tooltip_target;tooltip_target=$(e.currentTarget);el=tooltip_target.data("tooltip_el");tooltip_target.removeData("tooltip_el");if(!el){return}if(el.is(":visible")){return show_tooltip(tooltip_target,true)}}}(this);show=function(_this){return function(e){var tooltip_target;tooltip_target=$(e.currentTarget);if(tooltip_target.closest(".redactor-box").length){return}return show_tooltip(tooltip_target)}}(this);hide=function(_this){return function(e){var el,tooltip_target;tooltip_target=$(e.currentTarget);if(el=tooltip_target.data("tooltip_el")){return el.remove()}}}(this);if(this.is("[data-tooltip]")){this.on("i:refresh_tooltip",refresh);this.on("mouseenter focus",show);this.on("mouseleave blur i:hide_tooltip",hide)}else{this.on("i:refresh_tooltip","[data-tooltip], [aria-label]",refresh);this.on("i:clear_tooltips",function(){return tooltip_drop().empty()});this.on("mouseenter focus","[data-tooltip], [aria-label]",show);this.on("mouseleave blur i:hide_tooltip","[data-tooltip], [aria-label]",hide)}return this}}).call(this);(function(){var slice=[].slice,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.Lightbox=function(){Lightbox.lightbox_container=function(){return this._container||(this._container=$("#lightbox_container").exists()||$('<div id="lightbox_container"></div>').appendTo("body"))};Lightbox.shroud_container=function(){return this._shroud||(this._shroud=$("#lightbox_shroud").exists()||$('<div id="lightbox_shroud"></div>').appendTo("body"))};Lightbox.show_shroud=function(){var shroud;if(!this._shroud){shroud=this.shroud_container();this.lightbox_container().on("click",function(_this){return function(e){if(!$(e.target).closest(".lightbox").length){if($(e.target).attr("href")==="javascript:void(0)"){return}return _this.close()}}}(this));shroud.on("click",function(_this){return function(){return _this.close()}}(this));$(document.body).on("keydown",function(_this){return function(e){if(e.keyCode===27){e.preventDefault();e.stopPropagation();return _this.close()}else{return _this.on_keydown(e)}}}(this));$(window).on("resize",function(_this){return function(e){return _this.on_resize(e)}}(this))}this.shroud_container().addClass("invisible").show();return _.defer(function(_this){return function(){return _this.shroud_container().removeClass("invisible")}}(this))};Lightbox.hide_shroud=function(){return this.shroud_container().hide()};Lightbox.open_loading=function(){return this.open_tpl("loading_lightbox",I.Lightbox)};Lightbox.open_remote=function(){var T,args,url;url=arguments[0],T=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(T==null){T=I.Lightbox}this.open_loading();return $.ajax({dataType:"json",url:url,data:{lightbox:true},xhrFields:{withCredentials:true},success:function(_this){return function(res){if(res.errors){alert(res.errors.join(","));_this.close();return}return _this.open.apply(_this,[res.content,T].concat(slice.call(args)))}}(this),error:function(_this){return function(xhr,message,error){alert("Something went wrong. Please try again later and contact support if it persists.");return _this.close()}}(this)})};Lightbox.open_tpl=function(){var args,el,tpl;tpl=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];el=$("#"+tpl+"_tpl");if(!el.length){throw"missing template for lightbox: "+tpl}return this.open.apply(this,[el.html()].concat(slice.call(args)))};Lightbox.open_tpl_with_params=function(){var args,el,html,params,tpl;tpl=arguments[0],params=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];el=$("#"+tpl+"_tpl");if(!el.length){throw"missing template for lightbox: "+tpl}html=_.template(el.html())(params);return this.open.apply(this,[html].concat(slice.call(args)))};Lightbox.open=function(){var T,args,content,lightbox,lightbox_el,new_obj;content=arguments[0],T=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(T==null){T=I.Lightbox}if(this.current_lightbox){this.current_lightbox.close();this.current_lightbox=null}new_obj=false;if(content.$$typeof){new_obj=true;lightbox=new I.ReactLightbox(content,this)}else{if("string"===typeof content){content=$.trim(content)}lightbox_el=$(content);if(!(lightbox=lightbox_el.data("object"))){new_obj=true;lightbox=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(T,[lightbox_el,this].concat(slice.call(args)),function(){});lightbox_el.data("object",lightbox)}}$(document.body).addClass("lightbox_open");this.show_shroud();lightbox.show(new_obj);this.current_lightbox=lightbox;return lightbox};Lightbox.close=function(){var ref;if(this.current_lightbox&&!this.current_lightbox.is_closable()){return}if(this.current_lightbox&&this.current_lightbox.el.is(".has_changes")){if(!confirm("You've have unsaved changes in this dialog. Are you sure you want to close it?")){return}}this.hide_shroud();if((ref=this.current_lightbox)!=null){ref.close()}this.current_lightbox=null;return $(document.body).removeClass("lightbox_open")};Lightbox.on_keydown=function(e){var ref,ref1;return(ref=this.current_lightbox)!=null?(ref1=ref.el)!=null?ref1.trigger("i:lightbox_keydown",e):void 0:void 0};Lightbox.on_resize=function(e){var ref,ref1;return(ref=this.current_lightbox)!=null?(ref1=ref.el)!=null?ref1.trigger("i:lightbox_resize",e):void 0:void 0};Lightbox.prototype.lightbox_hidden=function(lb){};function Lightbox(){var el,parent1,rest;el=arguments[0],parent1=arguments[1],rest=3<=arguments.length?slice.call(arguments,2):[];this.parent=parent1;this.el=$(el);this.el.on("click",".close_button, .close_btn",function(_this){return function(e){I.Lightbox.close();return false}}(this));this.init.apply(this,rest)}Lightbox.prototype.init=function(){};Lightbox.prototype.first_show=function(){};Lightbox.prototype.with_selectize=function(fn){var html;if(!$.fn.selectize){html=this.el.data().selectize;if(!html){throw"missing selectize include in lightbox"}$("head").append(html)}return I.with_selectize(fn)};Lightbox.prototype.with_redactor=function(fn){var html;if(!$.fn.redactor){html=this.el.data().redactor;if(!html){throw"missing redactor include in lightbox"}$("head").append(html)}return I.with_redactor(fn)};Lightbox.prototype.show=function(first_time){var el,i,len,ref;this.el.add(this.parent.shroud_container()).add(this.parent.lightbox_container()).toggleClass("mobile_lb",$(window).width()<=600);this.el.appendTo(this.parent.lightbox_container()).addClass("animated").show().trigger("i:lightbox_open");this.position();if(first_time){ref=this.el.find("[data-js_init]");for(i=0,len=ref.length;i<len;i++){el=ref[i];eval($(el).data("js_init"))}return this.first_show()}};Lightbox.prototype.replace_content=function(c){var content;content=this.el.find(".content");content.empty();content.append(c);return this.position()};Lightbox.prototype.replace_title=function(title){this.el.find(".lightbox_title").html(title);return this.position()};Lightbox.prototype.add_css_class=function(c){return this.el.addClass(c)};Lightbox.prototype.remove_css_class=function(c){return this.el.removeClass(c)};Lightbox.prototype.close=function(){this.el.add(Lightbox.shroud_container()).add(Lightbox.lightbox_container()).removeClass("mobile_lb");return this.el.removeClass("animated").hide().trigger("i:lightbox_close").remove()};Lightbox.prototype.position=function(){var top;if(this.el.is(".mobile_lb")){return this.el.css({"margin-left":""})}else{top="fixed"===this.parent.lightbox_container().css("position")?"":$(window).scrollTop()+80+"px";return this.el.css({position:"absolute",top:top,"margin-left":-this.el.outerWidth()/2+"px"})}};Lightbox.prototype.closable=true;Lightbox.prototype.is_closable=function(){return this.closable};return Lightbox}();I.CenterLighbox=function(superClass){extend(CenterLighbox,superClass);function CenterLighbox(){this.position=bind(this.position,this);return CenterLighbox.__super__.constructor.apply(this,arguments)}CenterLighbox.prototype.position=function(){return this.el.css({position:"fixed",left:"50%",top:"50%","margin-left":-this.el.outerWidth()/2+"px","margin-top":-this.el.outerHeight()/2+"px"})};return CenterLighbox}(I.Lightbox);I.ReactLightbox=function(superClass){extend(ReactLightbox,superClass);function ReactLightbox(){var base,component,el,parent,rest,wrapper;component=arguments[0],parent=arguments[1],rest=3<=arguments.length?slice.call(arguments,2):[];wrapper=$('<div class="react_lightbox"></div>').appendTo(parent.lightbox_container());this.react_component=ReactDOM.render(component,wrapper[0]);el=ReactDOM.findDOMNode(this.react_component);ReactLightbox.__super__.constructor.apply(this,[el,parent].concat(slice.call(rest)));this.react_component.setState({lightbox:this});if(typeof(base=this.react_component).lightbox_initialized==="function"){base.lightbox_initialized()}}ReactLightbox.prototype.show=function(first_time){this.el.addClass("animated");return this.position()};ReactLightbox.prototype.close=function(){var parent;this.el.trigger("i:lightbox_close");parent=this.el.parent();ReactDOM.unmountComponentAtNode(parent[0]);return parent.remove()};return ReactLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.Header=function(){Header.prototype.track_category="header";function Header(el){this.setup_browse_menu=bind(this.setup_browse_menu,this);this.el=$(el);I.tracked_links(this.el,this.track_category,"click");this.el.on("click",".menu_tick",function(_this){return function(e){var body,menu,target;if($(e.target).closest(".drop_menu").length){return}target=$(e.currentTarget);menu=target.closest(".drop_menu_wrap").toggleClass("open");body=$(document.body);if(menu.is(".open")){target.trigger("i:track_link");return body.on("click.drop_menu",function(e){if($(e.target).closest(menu).length){return}menu.removeClass("open");return body.off("click.drop_menu")})}else{return body.off("click.drop_menu")}}}(this));this.setup_browse_menu()}Header.prototype.setup_browse_menu=function(){var browse_button;browse_button=this.el.find(".browse_btn");this.browse_menu=new I.HoverManager({timeout:750,enter_timeout:100,show:function(_this){return function(){_this.el.addClass("hover_menu_open");browse_button.addClass("open");return setTimeout(function(){return _this.el.addClass("hover_menu_visible")},0)}}(this),hide:function(_this){return function(){browse_button.removeClass("open");return _this.el.removeClass("hover_menu_visible")}}(this),after_fade:function(_this){return function(){return _this.el.removeClass("hover_menu_open")}}(this)});$(document.body).on("click",function(_this){return function(e){var c;c=$(e.target).closest(".browse_btn, .header_dropdown");if(c.length){return}_this.browse_menu.hide()}}(this));return this.el.on("mouseenter mouseleave",".browse_btn, .header_dropdown",function(_this){return function(e){if(e.type==="mouseenter"){return _this.browse_menu.enter()}else{return _this.browse_menu.leave()}}}(this))};return Header}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.HoverManager=function(){HoverManager.prototype.default_opts={timeout:1e3,enter_timeout:150,fade_timeout:400,show:function(){},hide:function(){},after_fade:function(){}};function HoverManager(opts){this._clear_enter_timeout=bind(this._clear_enter_timeout,this);this._clear_fade_timeout=bind(this._clear_fade_timeout,this);this._clear_leave_timeout=bind(this._clear_leave_timeout,this);this.opts=$.extend({},this.default_opts,opts);this.open=false}HoverManager.prototype.enter=function(){if(this.enter_timeout){return}this._clear_leave_timeout();this._clear_fade_timeout();return this.enter_timeout=window.setTimeout(function(_this){return function(){var base;delete _this.enter_timeout;if(!_this.open){if(typeof(base=_this.opts).show==="function"){base.show()}}return _this.open=true}}(this),this.opts.enter_timeout)};HoverManager.prototype.leave=function(){if(this.leave_timeout){return}this._clear_enter_timeout();return this.leave_timeout=window.setTimeout(function(_this){return function(){delete _this.leave_timeout;return _this.hide()}}(this),this.opts.timeout)};HoverManager.prototype.hide=function(){var base;this._clear_enter_timeout();this._clear_leave_timeout();if(this.open){if(typeof(base=this.opts).hide==="function"){base.hide()}}this.open=false;this.hiding=true;return this.fade_timeout=window.setTimeout(function(_this){return function(){var base1;if(typeof(base1=_this.opts).after_fade==="function"){base1.after_fade()}return _this.hiding=false}}(this),this.opts.fade_timeout)};HoverManager.prototype.show=function(){var base;return typeof(base=this.opts).show==="function"?base.show():void 0};HoverManager.prototype._clear_leave_timeout=function(){if(this.leave_timeout){window.clearTimeout(this.leave_timeout);return delete this.leave_timeout}};HoverManager.prototype._clear_fade_timeout=function(){if(this.fade_timeout){window.clearTimeout(this.fade_timeout);return delete this.fade_timeout}};HoverManager.prototype._clear_enter_timeout=function(){if(this.enter_timeout){window.clearTimeout(this.enter_timeout);return delete this.enter_timeout}};return HoverManager}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GameGridSizer=function(){GameGridSizer.prototype.selector=".game_grid_widget .game_cell .game_thumb";GameGridSizer.prototype.width_selector=".game_grid_widget .game_cell";GameGridSizer.prototype.expected_size=315;GameGridSizer.prototype.aspect_ratio=315/250;GameGridSizer.prototype.cell_margin=20;GameGridSizer.prototype.no_right_margin=false;GameGridSizer.prototype.min_columns=1;GameGridSizer.prototype.double=false;GameGridSizer.sizers={el_width:function(){var fraction_el,out,r,ref;fraction_el=(ref=this.el[0])!=null?ref.getBoundingClientRect().width:void 0;r=fraction_el-Math.floor(fraction_el);out=Math.floor(this.el.width());if(r>0){out-=1}return out},el_rect:function(){var ref;return Math.floor(((ref=this.el[0])!=null?ref.getBoundingClientRect().width:void 0)||0)}};GameGridSizer.initialize=_.once(function(){var body,disable_details,enable_details;body=$(document.body);disable_details=_.debounce(function(){return body.addClass("disable_hover")},200,true);enable_details=_.debounce(function(){return body.removeClass("disable_hover")},200);return $(window).on("scroll resize",function(){disable_details();enable_details()})});function GameGridSizer(opts){if(opts==null){opts={}}this.available_width=bind(this.available_width,this);this.on_size=bind(this.on_size,this);$.extend(this,opts);this.size_callbacks=[];this.constructor.initialize();$(window).on("resize",_.debounce(function(_this){return function(){return _this.resize_cells()}}(this),200));this.resize_cells();if(!I.in_test){_.defer(function(_this){return function(){return _this.resize_cells()}}(this))}}GameGridSizer.prototype.on_size=function(fn){return this.size_callbacks.push(fn)};GameGridSizer.prototype.available_width=function(){return $(window).width()};GameGridSizer.prototype.resize_cells=function(expected_width){var callback,css,i,len,new_height,new_width,num_cells,page_width,real_num_cells,real_width,ref,results;if(expected_width==null){expected_width=this.expected_size}real_width=expected_width+this.cell_margin;page_width=this.available_width();if(this.no_right_margin){page_width+=this.cell_margin}num_cells=page_width/real_width;real_num_cells=Math.ceil(num_cells);if(real_num_cells<this.min_columns){real_num_cells=this.min_columns}new_width=page_width/real_num_cells-this.cell_margin;new_height=new_width/this.aspect_ratio;new_width=Math.floor(new_width);new_height=Math.floor(new_height);this.cells_per_row=real_num_cells;if(this._style){this._style.remove()}css=this.selector+" {\n  width: "+new_width+"px;\n  height: "+new_height+"px;\n}";if(this.no_right_margin&&this.width_selector){css+=this.width_selector+":nth-child("+real_num_cells+"n) {\n  margin-right: 0;\n}"}if(this.width_selector){css+=this.width_selector+" {\n  width: "+new_width+"px;\n}"}this._style=$("<style type='text/css'>"+css+"</style>").appendTo($("head"));ref=this.size_callbacks;results=[];for(i=0,len=ref.length;i<len;i++){callback=ref[i];results.push(callback(this,new_width,new_height))}return results};return GameGridSizer}();I.GameCells=function(){function GameCells(el){this.setup_game_tools=bind(this.setup_game_tools,this);this.el=$(el);this.setup_game_tools();this.setup_gifs()}GameCells.prototype.setup_game_tools=function(){return this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){I.event("grid",I.page_name(),"add_to_collection");if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})};GameCells.prototype.setup_gifs=function(){return this.el.on("mouseenter",".game_cell",function(_this){return function(e){var el,gif_overlay;el=$(e.currentTarget);if(el.data("grid_hovered")){return}el.data("grid_hovered",true);gif_overlay=el.find(".gif_overlay");if(!gif_overlay.length){return}return gif_overlay.css("background-image","url("+gif_overlay.data("gif")+")")}}(this))};return GameCells}();I.GameGrid=function(){function GameGrid(el,opts){var copy_fields,field,i,is_css_grid,len,size_opts;if(opts==null){opts={}}this.refresh_images=bind(this.refresh_images,this);this.add_image_loading=bind(this.add_image_loading,this);this.setup_conversion_tracking=bind(this.setup_conversion_tracking,this);this.el=$(el);$.extend(this,opts);this.setup_lazy_images();if(this.show_popups!==false){new I.GamePopups(this.el)}new I.GameCells(this.el);is_css_grid=this.el.is(".layout_grid");if(!this.sizer&&this.sizer!==false&&!is_css_grid){copy_fields=["selector","width_selector","expected_size","min_columns","cell_margin","available_width"];size_opts={el:this.el,available_width:I.GameGridSizer.sizers.el_width};for(i=0,len=copy_fields.length;i<len;i++){field=copy_fields[i];if(field in opts){size_opts[field]=opts[field]}}this.sizer=new I.GameGridSizer(size_opts);this.sizer.on_size(function(_this){return function(){_this.el.trigger("i:grid_resize");return _this.el.lazy_images()}}(this))}}GameGrid.prototype.setup_lazy_images=function(){return _.defer(function(_this){return function(){return _this.add_image_loading()}}(this))};GameGrid.prototype.setup_conversion_tracking=function(source){this.el.on("i:impression",function(_this){return function(e){var conversion_el,game_id;conversion_el=$(e.target).closest("[data-game_id]");game_id=conversion_el.data("game_id");if(!game_id){return}return I.ConversionTracker.push("1:"+source+":1:"+game_id)}}(this));return this.el.on("i:delegate_tracking",function(_this){return function(e,push){var game_id;game_id=$(e.target).closest("[data-game_id]").data("game_id");if(!game_id){return}I.ConversionTracker.click(source+":1:"+game_id);return push(I.ConversionTracker.flush_now())}}(this))};GameGrid.prototype.add_image_loading=function(){return this.el.lazy_images({show_item:function(_this){return function(item){item.trigger("i:impression");return item.find(".image_loading").addBack(".image_loading").removeClass("image_loading")}}(this)})};GameGrid.prototype.refresh_images=function(){var base;return typeof(base=this.el.data("lazy_images"))==="function"?base():void 0};return GameGrid}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GamePopups=function(){GamePopups.prototype.trigger_selector=".game_thumb";GamePopups.prototype.popup_selector=".popup_details";GamePopups.prototype.hover_delay=250;GamePopups.prototype.close_timeout=200;GamePopups.prototype.x_offset=0;function GamePopups(el,opts){var body;if(opts==null){opts={}}this.deferred_for_el=bind(this.deferred_for_el,this);if(I.is_mobile()){return}this.el=$(el);$.extend(this,opts);body=$(document.body);this.el.on("mouseenter mouseleave",this.trigger_selector,function(_this){return function(e){el=$(e.currentTarget);if(el.closest(".jam_cell").length){return}if(el.closest(".disable_hover").length){return}if(e.type==="mouseenter"){return _this.enter(el)}else{return _this.leave(el)}}}(this));body.on("i:hide_popups",function(_this){return function(e,hm){return _this.close_popup()}}(this));body.on("i:hide_other_popups",function(_this){return function(e,hm){if(hm===_this){return}return _this.close_popup()}}(this))}GamePopups.prototype.deferred_for_el=function(el){var defer,game_id,popup_url;defer=el.data("i:popup_defer");if(!defer){game_id=el.closest("[data-game_id]").data("game_id");defer=$.Deferred();el.data("i:popup_defer",defer);if(!game_id){return}popup_url=I.subdomain?"/-/game/popup/"+game_id:"/game/popup/"+game_id;$.get(popup_url,function(_this){return function(popup_html){var popup;if(_.isObject(popup_html)&&popup_html.errors){return}popup=$(popup_html);popup.data("object_id",game_id);I.tracked_links(popup,"popups",I.page_name(),"click");popup.find("a").on("click",function(){var trigger;if(trigger=popup.data("trigger_el")){return trigger.trigger("i:track_link")}});return defer.resolve(popup)}}(this))}return defer};GamePopups.prototype.enter=function(el){var fast,slow;el.data("i:inside",true);slow=_.debounce(function(_this){return function(){if(!el.data("i:inside")){return}return _this.deferred_for_el(el).then(function(popup_el){return _this.show_popup(el,popup_el)})}}(this),this.hover_delay);fast=_.debounce(function(_this){return function(){var start;if(!el.data("i:inside")){return}start=new Date;return _this.deferred_for_el(el)}}(this),this.hover_delay/2);return el.on("mousemove.hover_manager",function(){slow();return fast()})};GamePopups.prototype.leave=function(el){el.data("i:inside",false);return el.off("mousemove.hover_manager")};GamePopups.prototype.show_popup=function(el,popup_el){var fn,i,j,len,ref,s,screenshots;if(this.current_popup===popup_el){return}this.el.trigger("i:hide_other_popups",[this]);if((ref=this.current_popup)!=null){ref.stop().remove()}this.current_popup=popup_el.css({left:"0px",top:"0px"}).removeClass("visible");screenshots=popup_el.find(".popup_screenshot").removeClass("visible");$(document.body).append(popup_el);this.position_popup(el,popup_el);_.defer(function(_this){return function(){return popup_el.addClass("visible")}}(this));popup_el.data("trigger_el",el);fn=function(_this){return function(s){return setTimeout(function(){return s.addClass("visible")},i*100)}}(this);for(i=j=0,len=screenshots.length;j<len;i=++j){s=screenshots[i];fn($(s))}popup_el.hide().css({opacity:""}).fadeIn("fast");return this.watch_for_popup_close()};GamePopups.prototype.watch_for_popup_close=function(){var close_timeout,target_selector;target_selector=this.trigger_selector+", "+this.popup_selector;close_timeout=null;$(document.body).on("click.hover_manager",function(_this){return function(e){var target;target=$(e.target);if(target.closest(target_selector).length){return}return _this.close_popup()}}(this));return $(window).on("mousemove.hover_manager",_.throttle(function(_this){return function(e){var inside;inside=$(e.target).closest(target_selector);if(inside.length){if(close_timeout){window.clearTimeout(close_timeout);close_timeout=null}return}if(!close_timeout){return close_timeout=window.setTimeout(function(){return _this.close_popup()},_this.close_timeout)}}}(this),50))};GamePopups.prototype.position_popup=function(el,popup){var height,left,offset,target_height,target_width,top,width;offset=el.offset();width=popup.outerWidth(true);height=popup.outerHeight(true);popup.removeClass("on_right");target_height=el.outerHeight();target_width=el.outerWidth();top=offset.top+(target_height-height)/2;left=offset.left-width;if(left<0){left=offset.left+target_width;left+=this.x_offset;popup.addClass("on_right")}else{left-=this.x_offset}return popup.css({top:Math.floor(top)+"px",left:Math.floor(left)+"px"})};GamePopups.prototype.close_popup=function(){var ref;$(window).off("mousemove.hover_manager");$(document.body).off("click.hover_manager");if((ref=this.current_popup)!=null){ref.stop(true).remove()}return this.current_popup=null};return GamePopups}();I.GamePopup=function(){function GamePopup(el){this.el=$(el);this.el.dispatch("click",{watch_trailer_btn:function(btn){I.event("grid",I.page_name(),"watch_trailer");return I.Lightbox.open_remote(btn.data("lightbox_url"))}})}return GamePopup}();I.WatchTrailerLightbox=function(){function WatchTrailerLightbox(el){this.el=$(el);this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){I.event("grid","trailer","add_to_collection");if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})}return WatchTrailerLightbox}()}).call(this);(function(){var slice=[].slice;I.ConversionTracker=function(){function ConversionTracker(){}ConversionTracker.types={impression:1,click:2,purchase:3,download:4};ConversionTracker.buffer=[];ConversionTracker.find_click=function(suffix){var ca,i,item,len,pattern;pattern=new RegExp(":"+suffix+"$");ca=ConversionTracker.get_cookie();for(i=0,len=ca.length;i<len;i++){item=ca[i];if(item.match(pattern)){return item}}};ConversionTracker.strip_click=function(suffix){var ca,item,new_ca,pattern;pattern=new RegExp(":"+suffix+"$");ca=ConversionTracker.get_cookie();new_ca=function(){var i,len,results;results=[];for(i=0,len=ca.length;i<len;i++){item=ca[i];if(item.match(pattern)){continue}results.push(item)}return results}();if(new_ca.length===ca.length){return}return ConversionTracker.write_cookie(new_ca)};ConversionTracker.after_click_action=function(type,suffix){var click,msg;click=ConversionTracker.find_click(suffix);if(!click){return}msg=click.replace(/^\d+/,ConversionTracker.types[type]);ConversionTracker.strip_click(suffix);ConversionTracker.push(msg);return true};ConversionTracker.download=function(suffix){return ConversionTracker.after_click_action("download",suffix)};ConversionTracker.purchase=function(suffix){return ConversionTracker.after_click_action("purchase",suffix)};ConversionTracker.click=function(suffix){var c,ca,msg;msg=ConversionTracker.types.click+":"+suffix;ConversionTracker.push(msg);try{ca=function(){var i,len,ref,results;ref=this.get_cookie();results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];if(c!==msg){results.push(c)}}return results}.call(ConversionTracker);ca.push(msg);while(ca.length>100){ca.shift()}return ConversionTracker.write_cookie(ca)}catch(error){}};ConversionTracker.write_cookie=function(ca){return I.set_cookie("itchio_ca",JSON.stringify(ca),{expires:1})};ConversionTracker.get_cookie=function(){var ca;ca=Cookies.get("itchio_ca");if(ca){try{return JSON.parse(ca)||[]}catch(error){try{return JSON.parse(decodeURIComponent(ca))||[]}catch(error){return[]}}}else{return[]}};ConversionTracker.flush_later=function(){ConversionTracker.flush_later=_.throttle(ConversionTracker.flush_now,2e3,{leading:false});$(window).on("beforeunload",function(){ConversionTracker.flush_now();return void 0});return ConversionTracker.flush_later()};ConversionTracker.encode_buffer=function(buffer){var _,ca,i,id,last_obj_type,last_source,last_type,len,obj_id,obj_type,out,p,ref,source,type;if(buffer==null){buffer=slice.call(ConversionTracker.buffer)}buffer.sort();out=[];last_type=null;last_source=null;last_obj_type=null;for(i=0,len=buffer.length;i<len;i++){ca=buffer[i];ref=ca.match(/^(\d+):(\d+):(\d+):(\d+)$/),_=ref[0],type=ref[1],source=ref[2],obj_type=ref[3],obj_id=ref[4];if(!type){continue}if(type!==last_type){out.push("t"+type);last_type=type}if(source!==last_source){out.push("s"+source);last_source=source}if(obj_type!==last_obj_type){out.push("o"+obj_type);last_obj_type=obj_type}id=(+obj_id).toString(36);p=String.fromCharCode("A".charCodeAt(0)+id.length);out.push(""+p+id)}return out.join("")};ConversionTracker.flush_url=function(){var p,x;x=ConversionTracker.encode_buffer();p={x:x};if(I.active_splits!=null){p.s=I.active_splits.join(",")}return I.root_url("ca.gif")+"?"+$.param(p)};ConversionTracker.flush_now_beacon=function(){var url;if(navigator.sendBeacon==null){return ConversionTracker.flush_now()}if(ConversionTracker.buffer.length){if(I.in_dev){console.debug("ca(beacon)",ConversionTracker.buffer)}url=ConversionTracker.flush_url();if(navigator.sendBeacon(url)){ConversionTracker.buffer=[]}else{return ConversionTracker.flush_now()}}return $.when()};ConversionTracker.flush_now=function(){var url;if(!ConversionTracker.buffer.length){return $.when()}if(I.in_dev){console.debug("ca",ConversionTracker.buffer)}url=ConversionTracker.flush_url();ConversionTracker.buffer=[];return $.Deferred(function(d){var done,img;img=new Image;img.src=url;done=function(){return d.resolve()};img.onerror=done;return img.onload=done})};ConversionTracker.push=function(msg){var v;ConversionTracker.buffer=function(){var i,len,ref,results;ref=this.buffer;results=[];for(i=0,len=ref.length;i<len;i++){v=ref[i];if(v!==msg){results.push(v)}}return results}.call(ConversionTracker);ConversionTracker.buffer.push(msg);if(ConversionTracker.buffer.length>50){return ConversionTracker.flush_now()}else{return ConversionTracker.flush_later()}};return ConversionTracker}()}).call(this);(function(){I.ReferrerTracker=function(){function ReferrerTracker(){}ReferrerTracker.MAX_ITEMS=20;ReferrerTracker.get_cookie=function(){return Cookies.getJSON("itchio_refs")||[]};ReferrerTracker.write_cookie=function(val){return I.set_cookie("itchio_refs",val,{expires:14})};ReferrerTracker.has_ref=function(type,id){var cid,ctype,i,len,ref,ref1;id=+id;ref=ReferrerTracker.get_cookie();for(i=0,len=ref.length;i<len;i++){ref1=ref[i],ctype=ref1[0],cid=ref1[1];if(ctype===type&&cid===id){return true}}return false};ReferrerTracker.push=function(type,id,value){var r,refs;if(!(value&&value.length>0)){return}id=+id;refs=function(){var i,len,ref,results;ref=this.get_cookie();results=[];for(i=0,len=ref.length;i<len;i++){r=ref[i];if(r[0]===type&&r[1]===id){continue}results.push(r)}return results}.call(ReferrerTracker);if(I.in_dev){console.log("pushing referrer",[type,id,value])}refs.unshift([type,id,value]);while(refs.length>ReferrerTracker.MAX_ITEMS){refs.pop()}return ReferrerTracker.write_cookie(refs)};return ReferrerTracker}()}).call(this);(function(){I.PerfPanel=function(){function PerfPanel(data){var tpl;data.layout_time||(data.layout_time=0);data.view_time||(data.view_time=0);data.db_time||(data.db_time=0);data.db_count||(data.db_count=0);data.host||(data.host="itch.io");tpl=_.template('<div class="perf_panel">\n  <div class="stat_row">\n    <strong>Queries:</strong> {{ db_count }}\n  </div>\n\n  <div class="stat_row">\n    <strong>Query time:</strong> {{ Math.floor(db_time * 1000) }}ms\n  </div>\n\n  <div class="stat_row">\n    <strong>View time:</strong> {{ Math.floor((view_time + layout_time) * 1000) }}ms\n  </div>\n\n  <div class="stat_row">\n    <strong>Rest:</strong> {{ Math.floor((total_time - (view_time + layout_time + db_time)) * 1000) }}ms\n  </div>\n\n</div>');$(document.body).append(tpl(data))}return PerfPanel}()}).call(this);(function(){var _hex_piece,hex_color,hsl_to_rgb,luma,mix_color,parse_color,parse_color_safe,readable_text_color,rgb_helper,rgb_to_hsl,rgb_to_yuv,scale_luma,sub_color,sub_color2,yuv_to_rgb,slice=[].slice;rgb_helper=function(comp,temp1,temp2){if(comp<0){comp+=1}else if(comp>1){comp-=1}if(6*comp<1){return temp1+(temp2-temp1)*6*comp}else if(2*comp<1){return temp2}else if(3*comp<2){return temp1+(temp2-temp1)*(2/3-comp)*6}else{return temp1}};hsl_to_rgb=function(h,s,l){var b,g,r,temp1,temp2;h=h/360;s=s/100;l=l/100;if(s===0){r=l;g=l;b=l}else{temp2=l<.5?l*(1+s):l+s-l*s;temp1=2*l-temp2;r=rgb_helper(h+1/3,temp1,temp2);g=rgb_helper(h,temp1,temp2);b=rgb_helper(h-1/3,temp1,temp2)}return[r*255,g*255,b*255]};rgb_to_hsl=function(r,g,b){var h,l,max,min,s;r=r/255;g=g/255;b=b/255;min=Math.min(r,g,b);max=Math.max(r,g,b);s=0;h=0;l=(min+max)/2;if(min!==max){s=l<.5?(max-min)/(max+min):(max-min)/(2-max-min);h=function(){switch(max){case r:return(g-b)/(max-min);case g:return 2+(b-r)/(max-min);case b:return 4+(r-g)/(max-min)}}()}if(h<0){h+=6}return[h*60,s*100,l*100]};parse_color=function(){var _,b,g,hex,hexhex,m,r,rest,six,str,three;str=arguments[0],rest=2<=arguments.length?slice.call(arguments,1):[];hex="[a-fA-f0-9]";hexhex=hex+hex;three="^#("+hex+")("+hex+")("+hex+")$";six="^#("+hexhex+")("+hexhex+")("+hexhex+")$";m=str.match(new RegExp(three));if(m){_=m[0],r=m[1],g=m[2],b=m[3];r+=r;g+=g;b+=b}else{m=str.match(new RegExp(six));if(!m){return null}_=m[0],r=m[1],g=m[2],b=m[3]}return[parseInt(r,16),parseInt(g,16),parseInt(b,16)]};parse_color_safe=function(){var color;color=parse_color.apply(null,arguments);return color||[0,0,0]};_hex_piece=function(i){var hex;hex=Math.floor(i).toString(16);if(hex.length===1){return"0"+hex}else{return hex}};hex_color=function(r,g,b){r=Math.min(255,Math.max(0,r));g=Math.min(255,Math.max(0,g));b=Math.min(255,Math.max(0,b));return"#"+_hex_piece(r)+_hex_piece(g)+_hex_piece(b)};sub_color=function(color,delta,sat_mul){var h,l,new_l,ref,s;if(delta==null){delta=15}if(sat_mul==null){sat_mul=.8}ref=rgb_to_hsl.apply(null,parse_color_safe(color)),h=ref[0],s=ref[1],l=ref[2];new_l=l>50?l-delta:l+delta;new_l=Math.max(0,Math.min(100,new_l));return hex_color.apply(null,hsl_to_rgb(h,s*sat_mul,new_l))};luma=function(r,g,b){return(.299*r+.587*g+.114*b)/255};rgb_to_yuv=function(r,g,b){var u,v,y;y=.299*r+.587*g+.114*b;u=(b-y)*.565;v=(r-y)*.713;return[y,u,v]};yuv_to_rgb=function(y,u,v){var b,g,r;r=y+1.403*v;g=y-.344*u-.714*v;b=y+1.77*u;return[r,g,b]};scale_luma=function(r,g,b,p){var ref,u,v,y;if(p==null){p=.1}ref=rgb_to_yuv(r,g,b),y=ref[0],u=ref[1],v=ref[2];if(p<0){y+=p*y}else{y+=p*(255-y)}return yuv_to_rgb(y,u,v)};readable_text_color=function(r,g,b){var h,l,ref,ref1,s;if(typeof r==="string"){ref=parse_color_safe(r),r=ref[0],g=ref[1],b=ref[2]}ref1=rgb_to_hsl(r,g,b),h=ref1[0],s=ref1[1],l=ref1[2];return l>=75&&"#000000"||"#ffffff"};sub_color2=function(color,delta,threshold){var b,g,l,r,ref;if(delta==null){delta=.15}if(threshold==null){threshold=.5}ref=parse_color_safe(color),r=ref[0],g=ref[1],b=ref[2];l=luma(r,g,b);if(l<threshold){return hex_color.apply(null,scale_luma(r,g,b,delta))}else{return hex_color.apply(null,scale_luma(r,g,b,-delta))}};mix_color=function(a,b,amount){var amount_i,b1,b2,g1,g2,r1,r2,ref,ref1;if(amount===1){return a}if(amount===0){return b}ref=parse_color_safe(a),r1=ref[0],g1=ref[1],b1=ref[2];ref1=parse_color_safe(b),r2=ref1[0],g2=ref1[1],b2=ref1[2];amount_i=1-amount;return hex_color(r1*amount+r2*amount_i,g1*amount+g2*amount_i,b1*amount+b2*amount_i)};I.Color={hsl_to_rgb:hsl_to_rgb,rgb_to_hsl:rgb_to_hsl,parse_color:parse_color,parse_color_safe:parse_color_safe,hex_color:hex_color,sub_color:sub_color,luma:luma,rgb_to_yuv:rgb_to_yuv,yuv_to_rgb:yuv_to_rgb,scale_luma:scale_luma,readable_text_color:readable_text_color,sub_color2:sub_color2,mix_color:mix_color}}).call(this);(function(){I.SaleList=function(){function SaleList(el){this.el=$(el);console.log(this.el);this.el.lazy_images({})}return SaleList}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.Index=function(){Index.prototype.get_grid_referrer_source=function(el){var source_el;source_el=el.closest("[data-ca_source]");if(source_el.length){return source_el.attr("data-ca_source")}return"1"};function Index(el,opts){var banner,grid,i,len,ref1,tracker;if(opts==null){opts={}}this.setup_blog_posts=bind(this.setup_blog_posts,this);this.setup_sizer=bind(this.setup_sizer,this);this.setup_countdowns=bind(this.setup_countdowns,this);this.toggle_sidebar=bind(this.toggle_sidebar,this);this.setup_impressions=bind(this.setup_impressions,this);this.get_grid_referrer_source=bind(this.get_grid_referrer_source,this);this.el=$(el);I.event2("view index");I.event("index","hit",""+(I.current_user&&"logged in"||"logged out"));if(opts.recs_count){I.event("index","recs_count",""+opts.recs_count)}new I.Header(this.el.find(".user_panel_widget"));this.el.has_tooltips();I.format_dates(this.el.find(".sale_list_widget"),"fromNow");this.setup_sizer();this.setup_impressions();this.setup_blog_posts();ref1=this.el.find(".index_game_grid");for(i=0,len=ref1.length;i<len;i++){grid=ref1[i];new I.GameGrid(grid,{sizer:this.sizer})}this.setup_countdowns();I.setup_grid_referrers(this.el,function(_this){return function(el){var ref;ref=el.closest("[data-grid_referrer]");if(ref.length){return ref.data("grid_referrer")}else{return"index:"}}}(this));tracker=I.ga_tracker("index");I.deferred_links(this.el,"a[data-label]",function(_this){return function(target){var game_id,source;game_id=target.closest("[data-game_id]").data("game_id");if(game_id){source=_this.get_grid_referrer_source(target);I.ConversionTracker.click(source+":1:"+game_id);return $.when(tracker(target),I.ConversionTracker.flush_now())}else{return tracker(target)}}}(this));if(I.is_mobile()){this.el.addClass("is_mobile")}this.el.on("submit",".game_search",function(_this){return function(e){var query;query=$(e.currentTarget).find("input").val();return I.event("index","search",query)}}(this));$(".header_widget .mobile_nav_btn").on("click",function(_this){return function(){I.event("index","mobile","menu_toggle");return _this.toggle_sidebar()}}(this));this.el.on("click",".game_promo_banner_widget .close_button",function(_this){return function(e){var button,url;button=$(e.currentTarget);button.closest(".game_section").remove();if(url=button.data("url")){return $.post(url,I.with_csrf())}}}(this));this.el.dispatch("click",{sidebar_close_btn:function(_this){return function(){return _this.toggle_sidebar()}}(this),sidebar_shroud:function(_this){return function(){return _this.toggle_sidebar()}}(this)});if((typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem("i:greenlight_nag"):void 0)==="hide"){this.el.find(".footer_banner").remove()}this.el.addClass("ready");banner=this.el.find(".footer_banner").on("click",".close_btn",function(_this){return function(){if(typeof localStorage!=="undefined"&&localStorage!==null){localStorage.setItem("i:greenlight_nag","hide")}return banner.remove()}}(this));setTimeout(function(){return banner.find("a").addClass("animate_heartbeat")},2e3)}Index.prototype.setup_impressions=function(){return this.el.on("i:impression",function(_this){return function(e){var id,source,target;target=$(e.target);id=target.closest("[data-game_id]").data("game_id");if(!id){return}source=_this.get_grid_referrer_source(target);return I.ConversionTracker.push("1:"+source+":1:"+id)}}(this))};Index.prototype.toggle_sidebar=function(){var shroud;this.el.find(".index_sidebar").toggleClass("visible");shroud=this.el.find(".sidebar_shroud").toggleClass("open");return _.defer(function(_this){return function(){return shroud.toggleClass("visible",shroud.is(".open"))}}(this))};Index.prototype.setup_countdowns=function(){var countdown,i,len,ref1,results;ref1=this.el.find(".sale_countdown");results=[];for(i=0,len=ref1.length;i<len;i++){countdown=ref1[i];countdown=$(countdown);results.push(new I.TimestampCountdown(countdown.find(".countdown_timestamp"),moment.utc(countdown.data("end_time"))))}return results};Index.prototype.setup_sizer=function(){var force_size,grid_container,ref1;grid_container=this.el.find(".index_game_grid");force_size=(ref1=window.location.hash.match(/\bsize=([^&]*)/))!=null?ref1[1]:void 0;this.sizer=new I.GameGridSizer({cell_margin:10,selector:".featured_game_grid_widget .game_cell .bordered",width_selector:".featured_game_grid_widget .game_cell",expected_size:force_size?+force_size:I.is_mobile()?300:250,available_width:function(_this){return function(){return grid_container.width()}}(this)});return this.sizer.on_size(function(_this){return function(sizer){var cells,grid,i,len,max_cells,overflow_target,ref2,remaining;ref2=_this.el.find("[data-max_rows]");for(i=0,len=ref2.length;i<len;i++){grid=ref2[i];grid=$(grid);cells=!grid.data("overflow_from")?grid.data("original_cells"):void 0;if(!cells){cells=grid.find(".game_cell");if(!grid.data("overflow_from")){grid.data("original_cells",cells)}}overflow_target=grid.data("overflow_into");if(overflow_target){overflow_target=$(".overflow_"+overflow_target)}max_cells=grid.data("max_rows")*sizer.cells_per_row;max_cells=Math.max(sizer.cells_per_row,Math.min(max_cells,Math.floor(cells.length/sizer.cells_per_row)*sizer.cells_per_row));remaining=cells.appendTo(grid).show().slice(max_cells);if(overflow_target){overflow_target.parent("section").toggle(!!remaining.length);overflow_target.append(remaining)}else{remaining.hide()}}return $(window).trigger("i:reshape")}}(this))};Index.prototype.setup_blog_posts=function(){return this.el.find(".blog_post_carousel").lazy_images({selector:".post_link",target:this.el.find(".blog_post_carousel ul"),horizontal:true})};return Index}()}).call(this);(function(){I.libs.react.done(function(){var LABELS,P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;LABELS={years:["year","years"],months:["month","months"],days:["day","days"],hours:["hour","hours"],minutes:["minute","minutes"],seconds:["second","seconds"]};P("Countdown",{pure:true,getDefaultProps:function(){return{max_blocks:4}},getInitialState:function(){return{time:new Date}},componentDidMount:function(){return this.interval=setInterval(function(_this){return function(){return _this.setState({time:new Date})}}(this),500)},componentWillUnmount:function(){return clearInterval(this.interval)},render:function(){var dur,hidable,parts,tuples,val;parts=["years","months","days","hours","minutes","seconds"];dur=moment.duration(moment(this.props.date).diff(moment(this.state.time)));hidable=true;tuples=function(){var i,len,results;results=[];for(i=0,len=parts.length;i<len;i++){p=parts[i];val=dur[p]();if(val===0&&hidable){continue}if(val>0){hidable=false}results.push([p,val])}return results}();tuples=tuples.slice(0,this.props.max_blocks);return this.enclose({className:this.props.className},tuples.map(function(_this){return function(arg){var part,plural,ref,singular,val;part=arg[0],val=arg[1];if(!val){return null}ref=LABELS[part],singular=ref[0],plural=ref[1];return div({className:"time_block",key:part},div({className:"block_value"},_.str.numberFormat(val))," ",div({className:"block_label"},val===1?singular:plural)," ")}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var P,PLATFORM_ICONS,PLATFORM_NAMES,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;PLATFORM_ICONS={linux:"tux",osx:"apple",windows:"windows8",android:"android"};PLATFORM_NAMES={linux:"Linux",osx:"macOS",windows:"Windows",android:"Android"};P("PlatformList",{pure:true,getDefaultProps:function(){return{prefix:"Available for"}},render:function(){var j,len,name,out,ref;if(!(this.props.platforms&&this.props.platforms.length)){return null}out=[];ref=this.props.platforms;for(j=0,len=ref.length;j<len;j++){name=ref[j];if(out.length>0){out.push(" ")}out.push(span({key:name,className:"icon icon-"+PLATFORM_ICONS[name],title:this.props.prefix+" "+PLATFORM_NAMES[name]}))}return out}});P("StarRating",{propTypes:{average:types.number,count:types.number},pure:true,render:function(){var i;return div({className:"game_rating"},div({className:"star_value"},div({className:"star_fill"},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star"}))}return results}()),div({className:"star_holes"},function(){var j,results;results=[];for(i=j=1;j<=5;i=++j){results.push(span({key:i,className:"star icon-star2"}))}return results}()))," ",span({title:(this.props.average||0).toFixed(2),className:"rating_count"},"("+I.format_integer(this.props.count)+")"))}});P("GameCell",{pure:true,getDefaultProps:function(){return{show_price:true,show_short_text:true,show_platforms:true,show_rating:true,show_cell_tools:true}},add_to_collection:function(e){if(I.current_user){e.preventDefault();return I.Lightbox.open_remote("/game/collections/"+this.props.game.id,I.CollectionLightbox)}},mark_gif_loaded:function(){return this.setState({gif_loaded:true})},track_grid_referrer:function(){if(!this.props.grid_referrer){return}return I.ReferrerTracker.push("game",this.props.game.id,this.props.grid_referrer)},game_link:function(props,children){var link_props;if(this.props.conversion_source){link_props=$.extend({object_type:1,object_id:this.props.game.id,source:this.props.conversion_source,on_click:this.props.grid_referrer?this.track_grid_referrer:void 0},props);return P.ConversionLink(link_props,children)}return a(props,children)},render:function(){var b,base,base1,cover_color,g,game,r,ref,ref1,user;game=this.props.game;user=game.user;cover_color=game.cover_color&&I.Color?(ref=I.Color.parse_color(game.cover_color),r=ref[0],g=ref[1],b=ref[2],ref,"rgba("+r+", "+g+", "+b+", 0.5)"):void 0;return this.enclose({className:"game_cell",onMouseEnter:this.props.game.gif_cover?function(_this){return function(){return _this.setState({hovering:true})}}(this):void 0,onMouseLeave:this.props.game.gif_cover?function(_this){return function(){return _this.setState({hovering:false})}}(this):void 0},div({className:"bordered",style:cover_color&&{backgroundColor:cover_color}},this.game_link({href:game.url,target:this.props.target,className:"game_thumb"},game.cover?P.LazyImage({src:game.cover}):div({className:"missing_image"},"no image :("),game.gif_cover?div({className:"gif_label"},"GIF"):void 0,((ref1=this.state)!=null?ref1.hovering:void 0)&&game.gif_cover?React.createElement(React.Fragment,{},!this.state.gif_loaded?div({className:"gif_loading_overlay"}):void 0,P.LazyImage({className:"gif_cover",src:game.gif_cover,on_load:this.mark_gif_loaded})):void 0),this.props.show_price&&game.sale_rate?div({className:"sale_flag"},div({className:"rate"},game.sale_rate+"%"),div({className:"mini_label"},"off")):void 0,game.platforms?div({className:"p_data fading_data"},P.PlatformList({platforms:game.platforms})):void 0,this.props.show_cell_tools?div({className:"fading_data cell_tools"},typeof(base=this.props).render_cell_extras==="function"?base.render_cell_extras(game):void 0,a({href:game.url+"/add-to-collection",title:this.t("add_to_collection.add_button"),className:"add_to_collection_btn",onClick:this.add_to_collection},span({className:"icon icon-playlist_add"}))):void 0),div({className:"label"},function(){if(this.props.show_price){switch(game.flag){case"free":return div({className:"meta_tag free_tag"},"Free");case"web":return div({className:"meta_tag free_tag"},"Web");case"demo":return div({className:"meta_tag demo_tag"},"Demo");default:if(game.price){return div({className:classNames("price_tag meta_tag")},game.price)}}}}.call(this),this.game_link({target:this.props.target,className:"title",title:game.title,href:game.url},game.title)),div({className:"user_row"},a({className:"user_link",href:user.url,target:this.props.target},user.name)),this.props.show_rating&&game.rating?P.StarRating(game.rating):void 0,game.tags&&game.tags.length?div({className:"sub cell_tags"},game.tags.map(function(_this){return function(tag,idx){return React.createElement(React.Fragment,{key:tag.name},idx>0?", ":void 0,a({href:tag.url,target:_this.props.target},"#"+tag.name))}}(this))):void 0,this.props.show_short_text?game.short_text?div({className:"sub short_text"},game.short_text):void 0:void 0,typeof(base1=this.props).render_cell_below==="function"?base1.render_cell_below(game):void 0)}});P("GameGrid",{calculate_cell_sizes:function(_this){return function(){var ref,ref1;return(ref=_this.grid_sizer_ref)!=null?(ref1=ref.current)!=null?ref1.calculate_cell_sizes():void 0:void 0}}(this),componentDidMount:function(){var container;container=this.container();if(this.props.enable_popups){return new I.GamePopups(container,{x_offset:10})}},getDefaultProps:function(){return{cell_width:I.is_mobile()?300:250,enable_popups:true}},render:function(){var props;props={ref:this.grid_sizer_ref||(this.grid_sizer_ref=React.createRef()),cell_margin:10,expected_width:this.props.cell_width,fit_rows:this.props.fit_rows,children:this.props.games&&this.props.games.map(function(_this){return function(game){props={render_cell_extras:_this.props.render_cell_extras,render_cell_below:_this.props.render_cell_below,key:game.id,game:game,conversion_source:_this.props.conversion_source,grid_referrer:_this.props.grid_referrer};if(_this.props.cell_props){props=$.extend(props,_this.props.cell_props)}return P.GameCell(props)}}(this))};if(this.props.grid_sizer_props){props=$.extend(props,this.props.grid_sizer_props)}return this.enclose({},P.GridSizer(props))}});P("NewFromFollowers",{getInitialState:function(){return{games:this.props.games}},componentDidUpdate:function(prev_props,prev_state){var ref,ref1;if(((ref=prev_state.games)!=null?ref.length:void 0)!==((ref1=this.state.games)!=null?ref1.length:void 0)){return $(window).trigger("i:reshape")}},on_dismiss_games:function(e){var g,grid_sizer,ref,ref1,ref2,ref3,visible_games;if((ref=this.state)!=null?ref.loading:void 0){return}grid_sizer=(ref1=this.game_grid_ref)!=null?(ref2=ref1.current)!=null?(ref3=ref2.grid_sizer_ref)!=null?ref3.current:void 0:void 0:void 0;if(!grid_sizer){return}visible_games=this.state.games.slice(0,grid_sizer.get_num_visible());if(!visible_games.length){return}this.setState({loading:true});return $.post(this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:function(){var j,len,results;results=[];for(j=0,len=visible_games.length;j<len;j++){g=visible_games[j];results.push(g.id)}return results}().join(",")})).done(function(_this){return function(res){return $.get(_this.props.more_results_url).done(function(more_games){return _this.setState({games:_.toArray(more_games.games),loading:false})})}}(this))},render_cell_extras:function(game){return button({type:"button",className:"dismiss_btn",onClick:function(_this){return function(){var g,remaining_games;remaining_games=function(){var j,len,ref,results;ref=this.state.games;results=[];for(j=0,len=ref.length;j<len;j++){g=ref[j];if(g!==game){results.push(g)}}return results}.call(_this);_this.setState({games:remaining_games});return $.post(_this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:game.id})).done(function(res){return _this.fetch_more_if_necessary()})}}(this)},"Dismiss")},fetch_more_if_necessary:function(){var grid,ref,ref1,ref2;if(this.state.loading){return}if(this.state.exhausted){return}grid=(ref=this.game_grid_ref)!=null?(ref1=ref.current)!=null?(ref2=ref1.grid_sizer_ref)!=null?ref2.current:void 0:void 0:void 0;if(!grid){return}if(!(grid.get_max_num_visible()>grid.get_num_visible())){return}this.setState({loading:true});return $.get(this.props.more_results_url).done(function(_this){return function(more_games){more_games=_.toArray(more_games!=null?more_games.games:void 0);return _this.setState({exhausted:more_games.length<grid.get_max_num_visible(),games:more_games,loading:false})}}(this))},render_dismiss_button:function(){var games;games=this.state.games;if(!games.length){return}return button({className:"button outline",type:"button",onClick:this.on_dismiss_games},this.state.games.length>1?"Dismiss these":"Dismiss")},render:function(){var ref;if(!this.state.games.length){return null}return this.enclose({className:classNames({loading:(ref=this.state)!=null?ref.loading:void 0})},div({className:"header_split"},div({},div({className:"section_header"},h2({},"New From Those You Follow")),p({className:"section_description"},"Projects from those you follow that you haven't seen yet.")),this.render_dismiss_button()),P.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.games,fit_rows:this.props.fit_rows,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,render_cell_extras:this.render_cell_extras}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,id_incr,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;id_incr=0;P("GridSizer",{propTypes:{children:types.array},getInitialState:function(){return{element_id:this.enclosing_class_name()+"_"+id_incr++}},getDefaultProps:function(){return{cell_margin:20,min_width:0,expected_width:315,min_columns:1,crop_on_resize:true}},componentDidMount:function(){_.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this));this.resize_callback=_.debounce(function(_this){return function(){return _this.calculate_cell_sizes()}}(this),250);return $(window).on("resize",this.resize_callback)},componentWillUnmount:function(){return $(window).off("resize",this.resize_callback)},componentDidUpdate:function(prev_props){if(prev_props.children!==this.props.children){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes()}}(this))}},calculate_cell_sizes:function(recurse){var calculated_width,container_width,new_width,num_cells,real_num_cells,real_width;if(recurse==null){recurse=false}container_width=this.get_width();if(this.state.container_width===container_width){return}real_width=this.props.expected_width+this.props.cell_margin;calculated_width=container_width+this.props.cell_margin;num_cells=calculated_width/real_width;real_num_cells=Math.ceil(num_cells);if(real_num_cells<this.props.min_columns){real_num_cells=this.props.min_columns}new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width);if(new_width<this.props.min_width&&real_num_cells>1){real_num_cells-=1;new_width=calculated_width/real_num_cells-this.props.cell_margin;new_width=Math.floor(new_width)}this.setState({container_width:container_width,cell_width:new_width,cells_per_row:real_num_cells},this.props.on_reshape);if(recurse===false){return _.defer(function(_this){return function(){return _this.calculate_cell_sizes(true)}}(this))}},get_width:function(){var el,fraction_el,out,r,ref;el=this.container();fraction_el=(ref=el[0])!=null?ref.getBoundingClientRect().width:void 0;r=fraction_el-Math.floor(fraction_el);out=Math.floor(el.width());if(r>0){out-=1}return out},get_max_num_visible:function(){if(this.props.fit_rows&&this.state.cells_per_row){return this.state.cells_per_row*this.props.fit_rows}},get_num_visible:function(){var num_children;num_children=this.props.children.length;if(this.props.fit_rows&&this.state.cells_per_row){return Math.min(num_children,this.state.cells_per_row*this.props.fit_rows)}else{return num_children}},render:function(){var children,container_style,sizer_fixed_width;children=this.props.children;if(this.props.fit_rows&&this.state.cells_per_row){children=children.slice(0,this.state.cells_per_row*this.props.fit_rows)}container_style=this.props.crop_on_resize?{overflowX:"hidden"}:void 0;sizer_fixed_width=this.props.crop_on_resize?{width:this.state.container_width+"px"}:void 0;return this.enclose({id:this.state.element_id,component:this.props.component,style:container_style},this.state.container_width?React.createElement(this.props.component||"div",{className:"grid_sizer_children",style:sizer_fixed_width},children):void 0,this.state.cell_width?React.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"#"+this.state.element_id+" > .grid_sizer_children > * {\n  display: inline-block;\n  vertical-align: top;\n  width: "+this.state.cell_width+"px;\n  margin-right: "+this.props.cell_margin+"px;\n}\n\n#"+this.state.element_id+" > .grid_sizer_children > *:nth-child("+this.state.cells_per_row+"n) {\n  margin-right: 0;\n}"}}):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;P("LazyImage",{pure:true,propTypes:{src:types.string,src_set:types.string,width:types.number,height:types.number},getInitialState:function(){return{visible:false}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_lazy_images=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base;_this.setState({visible:true});return typeof(base=_this.props).on_reveal==="function"?base.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images==="function"?this.unbind_lazy_images():void 0},render:function(){var ref,ref1;return img({className:classNames(this.props["class"],this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(ref=this.props.initial_width)!=null?ref:this.props.initial_width,height:this.state.loaded?this.props.height:(ref1=this.props.initial_height)!=null?ref1:this.props.initial_height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this):void 0})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;P("LazyVideo",{pure:true,getInitialState:function(){return{visible:false}},componentDidMount:function(){var el,handle_intersect;el=ReactDOM.findDOMNode(this);if(!el){return}handle_intersect=function(_this){return function(entities){var entity,i,len,results;results=[];for(i=0,len=entities.length;i<len;i++){entity=entities[i];results.push(_this.setState({visible:entity.isIntersecting}))}return results}}(this);this.io=new IntersectionObserver(handle_intersect,{});return this.io.observe(el)},componentWillUnmount:function(){var ref;return(ref=this.io)!=null?ref.disconnect():void 0},render:function(){if(!I.support_intersection_observer()){return null}return React.createElement("video",{className:classNames(this.enclosing_class_name,this.props.className),src:this.state.visible?this.props.src:void 0,autoPlay:true,loop:true,muted:true,playsInline:true})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;P("UserFollowCell",{pure:true,propTypes:{user:types.object.isRequired},getInitialState:function(){return{}},render:function(){var user;user=this.props.user;return li({key:user.id,className:classNames("user_cell")},div({className:"user_info"},a({className:"user_avatar",href:user.url,target:"_blank"},user.avatar_url?P.LazyImage({src:user.avatar_url,srcSet:user.avatar_url+" 1x, "+user.avatar_url2x+" 2x",width:35,height:35}):void 0),div({},a({target:"_blank",href:user.url,className:"user_name"},user.name),div({className:"cell_tools"},R.FollowButton({show_name:false,user_id:user.id,follow_url:user.follow_url,unfollow_url:user.unfollow_url,follow_data:{source:"home_suggested"},on_follow_change:function(_this){return function(following){var base;if(typeof(base=_this.props).follow_user==="function"){base.follow_user(user,following)}return _this.setState({following:following})}}(this)}),button({type:"button",style:{visibility:this.state.following?"hidden":void 0},className:"textlike dismiss_button","data-tooltip":this.t("index.to_follow.dismiss_tooltip"),onClick:this.dismiss_callback||(this.dismiss_callback=function(_this){return function(){var base;_this.container().trigger("i:clear_tooltips");return typeof(base=_this.props).dismiss_user==="function"?base.dismiss_user(user):void 0}}(this))},this.tt("misc.dismiss"))),user.games?div({className:"created"},this.tt("index.to_follow.created_projects",{project_list:ul({className:"created_list"},user.games.map(function(_this){return function(game){return li({key:game.id},a({href:game.url,"data-game_id":game.id,target:"_blank"},game.title))}}(this)))})):void 0)))}});P("UsersToFollow",{propTypes:{users:types.array},getInitialState:function(){return{users:this.props.users,followed_count:0,followed_users:{}}},componentDidMount:function(){return new I.GamePopups(this.container(),{trigger_selector:"[data-game_id]",x_offset:10})},refresh_users:function(){if(this.state.loading){return}this.setState({loading:true});return $.getJSON(this.props.more_users_url,function(_this){return function(res){var have_users,i,j,len,len1,ref,user,users;_this.setState({loading:false});users=function(){var i,len,ref,results;ref=this.state.users;results=[];for(i=0,len=ref.length;i<len;i++){user=ref[i];if(!this.state.followed_users[user.id]){results.push(user)}}return results}.call(_this);have_users={};for(i=0,len=users.length;i<len;i++){user=users[i];have_users[user.id]=true}if(res.users){ref=res.users;for(j=0,len1=ref.length;j<len1;j++){user=ref[j];if(have_users[user.id]){continue}users.push(user)}}return _this.setState({users:_.shuffle(users),followed_count:0,followed_users:{}})}}(this))},increment_follow:function(user,following){var update;update={};update[user.id]=following||false;return this.setState({followed_count:this.state.followed_count+(following?1:-1),followed_users:$.extend(this.state.followed_users,update)})},dismiss_user:function(user){var su;$.post(user.dismiss_url,I.with_csrf(),function(_this){return function(){if(_this.state.users.length<10){return _this.refresh_users()}}}(this));return this.setState({users:function(){var i,len,ref,results;ref=this.state.users;results=[];for(i=0,len=ref.length;i<len;i++){su=ref[i];if(su!==user){results.push(su)}}return results}.call(this)})},render:function(){if(!this.state.users){return null}return this.enclose({},this.state.users&&this.state.users.length?P.GridSizer({component:"ul",cell_margin:10,expected_width:250,min_width:200,fit_rows:I.is_mobile()?3:1,children:this.state.users.map(function(_this){return function(user){return P.UserFollowCell({key:user.id,user:user,dismiss_user:_this.dismiss_user,follow_user:_this.increment_follow})}}(this))}):p({className:"empty_message"},this.tt("index.to_follow.empty_results")),this.state.followed_count>0&&this.state.users&&this.state.users.length?div({className:"refresh_users"},button({type:"button",disabled:this.state.loading||false,className:classNames("textlike",{disabled:this.state.loading}),onClick:function(_this){return function(e){return _this.refresh_users()}}(this)},this.tt("index.to_follow.refresh_button"))):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,SEEN_EVENTS,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;SEEN_EVENTS={};P("ConversionLink",{pure:true,propTypes:{source:types.number,object_type:types.number,object_id:types.number,href:types.string,target:types.string,class:types.any,impression:types.bool,on_click:types.func,on_impression:types.func},getInitialState:function(){return{seen:false}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(e){var el,finished,is_blank,start;if(e.type!=="click"){return}el=ReactDOM.findDOMNode(this);is_blank=e.metaKey||e.ctrlKey||e.shiftKey||this.props.target==="_blank";p=this.handle_click();if(is_blank){return}if(p.state()==="resolved"){return}e.preventDefault();start=new Date;finished=function(_this){return function(){if(!finished){return}finished=null;return window.location=_this.props.href}}(this);setTimeout(function(_this){return function(){return typeof finished==="function"?finished():void 0}}(this),200);return p.done(finished)},on_mouse_up:function(e){if(e.button!==1){return}return this.handle_click()},handle_click:function(){var base,event_name,ref;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return $.when()}if(this.state.clicked){return this.state.clicked}event_name=I.ConversionTracker.types.click+":"+this.get_suffix();if(SEEN_EVENTS[event_name]){return $.when()}SEEN_EVENTS[event_name]=true;I.ConversionTracker.click(this.get_suffix());p=I.ConversionTracker.flush_now_beacon();if(this.props.track_referrer){(ref=I.ReferrerTracker).push.apply(ref,this.props.track_referrer)}this.setState({clicked:p});if(typeof(base=this.props).on_click==="function"){base.on_click()}return p},componentDidMount:function(){var el;if(!(this.props.object_type&&this.props.source&&this.props.object_id)){return}if(this.props.impression===false){return}if(SEEN_EVENTS[I.ConversionTracker.types.impression+":"+this.get_suffix()]){return}el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base,event_name;event_name=I.ConversionTracker.types.impression+":"+_this.get_suffix();if(!SEEN_EVENTS[event_name]){I.ConversionTracker.push(event_name);SEEN_EVENTS[event_name]=true}_this.setState({seen:true});if(typeof(base=_this.props).on_impression==="function"){base.on_impression()}if(typeof _this.unbind_visibility==="function"){_this.unbind_visibility()}return _this.unbind_visibility=null}}(this)})},componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},render:function(){return a({href:this.props.href,className:this.props["class"]||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target},this.props.children)}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);types=PropTypes;R("FollowButton",{propTypes:{following:types.bool,show_name:types.bool,name:types.string,login_url:types.string,user_id:types.number,follow_data:types.object,follow_url:types.string.isRequired,unfollow_url:types.string.isRequired},getInitialState:function(){return{following:this.props.following}},getDefaultProps:function(){return{show_name:true}},componentDidUpdate:function(prev_props,prev_state){if(!prev_state.animate_class&&this.state.animate_class){if(this.timer){window.clearTimeout(this.timer);delete this.timer}return this.timer=setTimeout(function(_this){return function(){return _this.setState({animate_class:null})}}(this),500)}},componentWillUnmount:function(){if(this.timer){window.clearTimeout(this.timer);return delete this.timer}},render:function(){var inside;inside=this.state.following?this.state.hovering?this.props.show_name?this.tt("misc.follow_button.unfollow_username",{username:this.props.name}):this.tt("misc.follow_button.unfollow"):React.createElement(React.Fragment,{},span({className:"icon icon-checkmark","aria-hidden":true,role:"img"}),this.props.show_name?this.tt("misc.follow_button.following_username",{username:this.props.name}):this.tt("misc.follow_button.following")):React.createElement(React.Fragment,{},span({className:"icon icon-plus","aria-hidden":true,role:"img"}),this.props.show_name?this.tt("misc.follow_button.follow_username",{username:this.props.name}):this.tt("misc.follow_button.follow"));return this.enclose({component:this.props.login_url?"a":"button",href:this.props.login_url,"data-label":"follow_btn",className:classNames("button",{is_following:this.state.following,disabled:this.state.loading},this.state.animate_class,this.props.className),onMouseEnter:function(_this){return function(){return _this.setState({hovering:true})}}(this),onMouseLeave:function(_this){return function(){return _this.setState({hovering:false})}}(this),target:this.props.target,onClick:function(_this){return function(e){var btn,url;if(_this.props.login_url){return}if(_this.state.loading){return}e.preventDefault();btn=$(e.target);_this.setState({loading:true,animate_class:null});_this.container().trigger("i:track_link");url=_this.state.following?_this.props.unfollow_url:_this.props.follow_url;return $.post(url,I.with_csrf(_this.props.follow_data),function(res){if(res.errors){I.flash(res.errors.join(", "));_this.setState({loading:false});return}btn.trigger("i:follow_updated",[{user_id:_this.props.user_id,following:res.following,btn:btn}]);return _this.setState({following:res.following,animate_class:res.following?"animate_bounce":"animate_drop_down",loading:false},function(){var base;return typeof(base=_this.props).on_follow_change==="function"?base.on_follow_change(_this.state.following):void 0})})}}(this)},inside)}})})}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CollectionLightbox=function(superClass){extend(CollectionLightbox,superClass);function CollectionLightbox(){return CollectionLightbox.__super__.constructor.apply(this,arguments)}CollectionLightbox.prototype.init=function(){var form;I.has_follow_button(this.el);I.event2("view add to collection lightbox");this.el.find("input[type='radio']:first").prop("checked",true);this.el.on("click change",".collection_option",function(_this){return function(e){var row;row=$(e.currentTarget);return row.find("input[type='radio']").prop("checked",true)}}(this));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}_this.el.addClass("is_complete");return _this.el.find(".after_submit .collection_name").text(res.title).attr("href",res.url)}}(this));this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:40,source:false,buttons:["bold","italic","deleted","lists","link"]})}}(this));return this.with_selectize(function(_this){return function(){return _this.el.find("select.collection_input").selectize()}}(this))};return CollectionLightbox}(I.Lightbox)}).call(this);
